# Codex AGENT для recruitsmart_admin

## Проект

HR / рекрутинг-система SMART SERVICE:

- FastAPI admin UI (`backend/apps/admin_ui/app.py`)
- Admin API (`backend/apps/admin_api/main.py`)
- Telegram-бот (`backend/apps/bot/app.py`, `bot.py`)
- БД: PostgreSQL в production, SQLite в dev/test
- Миграции: кастомные, через `backend/migrations/runner.py` и `scripts/run_migrations.py`

## Общие правила работы

- Всегда сначала **читай код и существующие файлы** (DEPLOYMENT_GUIDE.md, PROJECT_AUDIT.md, PROD_CHECKLIST.md), потом что-то меняй.
- Любые изменения делай **только внутри репозитория** `recruitsmart_admin`.
- Никогда не трогай секреты (.env, .env.prod) и реальные токены. Если нужно — используй плейсхолдеры.

## Что можно делать без моего явного подтверждения

- Редактировать Python-код, миграции, тесты, скрипты внутри репо.
- Создавать новые файлы: `DEPLOY_*`, `scripts/*.sh`, `tests/test_*.py`, документацию в `.md`.
- Запускать локальные команды анализа/тестов, если они описаны в README/DEPLOYMENT_GUIDE:
  - `python -m pytest ...`
  - `scripts/prod_smoke.sh`
  - `python scripts/run_migrations.py` (ТОЛЬКО с dev/test окружением, не prod).
- Предлагать изменения в systemd/nginx в виде текста (unit-файлы, конфиги) **внутри репозитория**.

## Что делать ТОЛЬКО после моего явного подтверждения

- Любые команды, которые:
  - что-то удаляют (`rm`, `drop`, `truncate`)
  - изменяют git-историю (`git push`, `git reset --hard`, `git rebase` на удалённые ветки)
  - могут сломать прод:
    - команды для `systemctl` на сервере
    - реальные prod-миграции
    - изменение `.env.prod` или других prod-конфигов
- Деплой на реальный сервер (VPS).

## Git-workflow

- Активная ветка разработки: `fix/merge-ready-iteration1`.
- По умолчанию:
  - Вноси изменения в текущую ветку.
  - После серии изменений:
    - Покажи `git diff`.
    - Предложи понятное сообщение коммита.
- Не делай `git push` без явного моего запроса.

## Тесты и качество

- Перед тем как говорить «готово», старайся:
  - Запускать связанные тесты (`pytest tests/...`).
  - Если правятся прод-настройки — запускать `tests/test_prod_*.py` и `tests/test_session_cookie_config.py`.
- Уважай существующий стиль кода:
  - SQLAlchemy 2.0 async-стиль
  - aiogram 3.x
- Не переписывай архитектуру бота / админки без явной задачи.

## Работа с сервером (VPS)

- НИКОГДА не выполняй команды на сервере напрямую.
- Если нужно что-то сделать на `root@185.104.115.19`, всегда:
  - Сначала сгенерируй список команд (SSH, systemctl, миграции, nginx).
  - Я сам выполню их в терминале.

## Как формировать ответы

- Сначала краткий план изменений.
- Потом код/дифф/конфиги.
- Потом список команд, которые я должен выполнить:
  - локально
  - на сервере.
