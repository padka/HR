{% extends "base.html" %}
{% block title %}Редактирование вопроса{% endblock %}
{% block content %}

<section class="glass" style="padding:24px;">
  <a href="/questions" class="muted" style="font-size:13px;">← Назад к списку</a>
  <h1 style="margin:8px 0 18px;">Редактирование вопроса</h1>

  {% if error_message %}
    <div style="margin-bottom:18px; padding:12px 16px; border-radius:12px; border:1px solid rgba(255,0,0,.25); background:rgba(255,0,0,.08); color:#ffdede;">
      {{ error_message }}
    </div>
  {% endif %}

  <form action="/questions/{{ detail.question.id }}/update" method="post" style="display:grid; gap:16px;">
    <div style="display:grid; gap:12px; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); align-items:end;">
      <label>
        <span class="muted" style="display:block; margin-bottom:6px;">Тест</span>
        <select name="test_id" required>
          {% for key, label in detail.test_choices %}
            <option value="{{ key }}" {% if key == detail.question.test_id %}selected{% endif %}>{{ label }} ({{ key }})</option>
          {% endfor %}
        </select>
      </label>
      <label>
        <span class="muted" style="display:block; margin-bottom:6px;">Порядковый номер</span>
        <input type="number" name="question_index" min="1" value="{{ detail.question.question_index }}" required>
      </label>
      <label style="display:flex; gap:8px; align-items:center;">
        <input type="checkbox" name="is_active" value="1" {% if detail.question.is_active %}checked{% endif %}>
        <span>Вопрос активен</span>
      </label>
    </div>

    <label>
      <span class="muted" style="display:block; margin-bottom:6px;">Заголовок для списка</span>
      <input type="text" name="title" value="{{ detail.question.title }}" placeholder="Например: Ознакомительный день" autocomplete="off">
    </label>

    <label>
      <span class="muted" style="display:block; margin-bottom:6px;">JSON данных вопроса</span>
      <textarea name="payload" rows="16" style="width:100%; font-family:'JetBrains Mono','Fira Code',monospace;">{{ detail.payload_json }}</textarea>
      <span class="muted" style="font-size:12px;">Структура должна соответствовать формату, который использует бот. Для вопросов с вариантами ответов укажите поля <code>options</code> и <code>correct</code>.</span>
    </label>

    <div style="display:flex; gap:12px; justify-content:flex-end;">
      <a class="btn" href="/questions">Отмена</a>
      <button type="submit">Сохранить изменения</button>
    </div>
  </form>
</section>
{% endblock %}
