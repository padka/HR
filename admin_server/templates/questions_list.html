{% extends "base.html" %}
{% block title %}Вопросы{% endblock %}
{% block content %}

<section class="glass" style="padding:24px; margin-bottom:20px;">
  <h1 style="margin:0 0 12px;">База вопросов</h1>
  <p class="muted" style="margin:0; max-width:720px;">
    Здесь собраны вопросы для всех тестов. Вы можете открыть вопрос и изменить его текст,
    варианты ответов или структуру JSON. Изменения вступят в силу после сохранения.
  </p>
</section>

{% if tests %}
  {% for test in tests %}
    <section class="glass" style="padding:18px; margin-bottom:20px;" data-tilt>
      <header style="display:flex; align-items:center; gap:12px; margin-bottom:14px; flex-wrap:wrap;">
        <h2 style="margin:0; font-size:20px;">{{ test.title }}</h2>
        <span class="badge">{{ test.test_id }}</span>
        <span class="muted" style="margin-left:auto;">{{ test.questions|length }} вопросов</span>
      </header>
      <div style="overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="padding:10px 12px; text-align:left; width:80px;">№</th>
              <th style="padding:10px 12px; text-align:left;">Вопрос</th>
              <th style="padding:10px 12px; text-align:left; width:140px;">Тип</th>
              <th style="padding:10px 12px; text-align:left; width:160px;">Последнее изменение</th>
              <th style="padding:10px 12px; text-align:left; width:120px;">Статус</th>
              <th style="padding:10px 12px; text-align:right; width:120px;">Действия</th>
            </tr>
          </thead>
          <tbody>
          {% for item in test.questions %}
            <tr style="border-top:1px solid rgba(255,255,255,0.06);">
              <td style="padding:10px 12px;">{{ item.index }}</td>
              <td style="padding:10px 12px;">
                <div style="font-weight:600;">{{ item.title }}</div>
                <div class="muted" style="font-size:12px;">{{ item.prompt }}</div>
                {% if item.options_count %}
                  <div class="muted" style="font-size:12px; margin-top:4px;">
                    Вариантов: {{ item.options_count }}{% if item.correct_label %}, верный: {{ item.correct_label }}{% endif %}
                  </div>
                {% endif %}
              </td>
              <td style="padding:10px 12px;">
                {% if item.kind == 'choice' %}
                  <span class="badge" style="display:inline-block;">Варианты</span>
                {% else %}
                  <span class="badge" style="display:inline-block;">Свободный ответ</span>
                {% endif %}
              </td>
              <td style="padding:10px 12px;">{% if item.updated_at %}{{ fmt_utc(item.updated_at) }} UTC{% else %}—{% endif %}</td>
              <td style="padding:10px 12px;">
                {% if item.is_active %}
                  <span class="badge" style="color:var(--ok); border-color:rgba(35,209,139,.35);">Активен</span>
                {% else %}
                  <span class="badge" style="color:var(--muted);">Скрыт</span>
                {% endif %}
              </td>
              <td style="padding:10px 12px; text-align:right;">
                <a class="btn" href="/questions/{{ item.id }}/edit">Редактировать</a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" style="padding:20px; text-align:center;" class="muted">Пока нет вопросов.</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  {% endfor %}
{% else %}
  <section class="glass" style="padding:24px;">
    <p class="muted" style="margin:0;">Вопросы ещё не добавлены.</p>
  </section>
{% endif %}
{% endblock %}
