# Risk Register

| Area | Observation | Impact | Recommendation |
| --- | --- | --- | --- |
| Bot/runtime coupling | Admin UI imports bot services at module import (e.g., slots API) requiring `aiohttp`/`aiogram`, so deployments without bot extras crash during startup or audits.【F:backend/apps/admin_ui/services/slots.py†L17-L33】 | Blocks admin-only deployments; `collect_metrics.py`/health tooling fail without installing bot stack. | Introduce feature flag + lazy imports/null adapters so admin UI can run with `BOT_ENABLED=0` and no optional deps. |
| Session middleware assumptions | `require_admin` always accesses `request.session`, but SessionMiddleware is optional and disabled when secret missing, causing `AttributeError` → 500s on login flows.【F:backend/apps/admin_ui/app.py†L44-L82】【F:backend/apps/admin_ui/security.py†L97-L158】 | Authentication path returns 500 instead of falling back to HTTP Basic, blocking prod usage when secret misconfigured. | Enforce mandatory secret in prod and guard session access with feature detection/basic-only fallback. |
| Asset duplication | Static CSS/JS bundles have suffixed duplicates (`liquid-dashboard 2.css`, `dashboard-calendar 2.js`, etc.), inflating bundle size and fragmenting tokens.【F:backend/apps/admin_ui/static/css/liquid-dashboard 2.css†L1-L200】【F:backend/apps/admin_ui/static/js/modules/dashboard-calendar 2.js†L1-L200】 | Inconsistent theming, >90 KB CSS budget, hard to maintain tokens across files. | Consolidate into single Tailwind pipeline with `tokens.css`, remove duplicated assets, regenerate components from Dashboard design system. |
| Pagination limits | `/api/slots` exposes `limit` up to 500 with no pagination metadata; UI depends on full list for filtering.【F:backend/apps/admin_ui/routers/api.py†L57-L66】 | Large responses degrade performance and risk exceeding budgets; downstream clients can't paginate safely. | Introduce shared pagination schema (items/total/page tokens) with max limit ≤100 and enforce server-side caps. |
| Duplicate ORM utilities | `backend/domain/models.py` defines `UTCDateTime` and logger twice (top/bottom), indicating merge debt and risk of divergent behaviour.【F:backend/domain/models.py†L1-L211】【F:backend/domain/models.py†L212-L313】 | Maintenance hazard; future edits may touch one copy only leading to inconsistent timezone coercion. | Deduplicate helper and centralise in `backend/domain/types.py`, update imports. |
| Security headers | App only uses TrustedHost/HTTPS redirect; lacks HSTS, CSP, COOP/COEP, cookie SameSite enforcement beyond defaults.【F:backend/apps/admin_ui/app.py†L44-L82】 | Browser security posture weak (clickjacking, XSS risk). | Add secure headers middleware (report-only CSP initially), ensure cookies flagged Secure+HttpOnly+SameSite, document defaults. |
| Bootstrap side-effects | `ensure_database_ready` runs migrations + seeds on every startup, even for ephemeral metrics scripts, and requires sync engine; fails when DB unavailable.【F:backend/core/bootstrap.py†L15-L114】 | Slow cold starts, crash loops on read-only smoke runs without database. | Make bootstrap optional/feature-flagged, add timeout/backoff, separate health vs data seeding. |
| Observability gap | No request-id middleware or structured logging; health endpoints combine readiness/liveness, lacking metrics exports.【F:backend/apps/admin_ui/routers/system.py†L23-L145】 | Difficult to trace API latency and integrate with monitoring; 503s ambiguous. | Add middleware for request-id/logging, split `/healthz`/`/readyz`, expose metrics (Prometheus or OTEL). |
