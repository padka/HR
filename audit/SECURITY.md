# Безопасность

- **Демо-секреты и реальные идентификаторы в репозитории.** В `.env.example` зашиты реальные значения (`ADMIN_CHAT_ID=7588303412`, дефолтные `ADMIN_USER=admin`/`ADMIN_PASSWORD=change-me`). При запуске без переопределения админка отвечает 503/401, но если конфиг промахнётся, сервис остаётся с тривиальными учётками. Рекомендуется: перенести пример в `.env.template` без реальных данных, добавить проверку в `require_admin` на отсутствие значений и аварийно завершать приложение в prod. 【F:.env.example†L1-L37】【F:backend/apps/admin_ui/security.py†L15-L38】
- **HTTP Basic без rate limiting и журналирования.** В `require_admin` отсутствует защита от перебора, а ответы 401 возвращаются одинаковые. Добавьте ограничение по IP / captcha или интеграцию с reverse-proxy rate limiting. 【F:backend/apps/admin_ui/security.py†L15-L38】
- **Не настроены политики безопасности ответов.** В FastAPI приложении не включены HSTS, CSP и защита от clickjacking. Рекомендуется добавить `SecurityMiddleware`/`TrustedHostMiddleware` и задокументировать требования к reverse-proxy. 【F:backend/apps/admin_ui/app.py†L29-L58】
- **Bot-интеграция стартует даже без токена.** `_build_bot` допускает пустой `BOT_TOKEN` и лишь выводит warning, что оставляет возможность случайно активировать NullBot. Стоит либо отключать API без токена, либо валидировать настройки жёстче в прод-сборке. 【F:backend/apps/admin_ui/state.py†L63-L115】
- **В хранилище нет автоматического управления ключами.** Настройка `SESSION_SECRET` генерируется на лету, но на длительных кластерах нужно обеспечить ротацию и хранение через secrets manager. Задокументируйте процедуру и запретите запуск без явного секрета в prod. 【F:backend/core/settings.py†L81-L115】
