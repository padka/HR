<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–°–ª–æ—Ç—ã ¬∑ TG Bot Admin</title>
  <link rel="icon" href="/static/favicon.ico">
  <script>
    (function () {
      const storageKey = 'tg-admin-theme';
      try {
        const stored = window.localStorage.getItem(storageKey);
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.dataset.theme = theme;
        document.documentElement.style.colorScheme = theme;
      } catch (err) {
        document.documentElement.dataset.theme = 'light';
        document.documentElement.style.colorScheme = 'light';
      }
    })();
  </script>
  <link rel="stylesheet" href="/static/css/tokens.css">
  <link rel="stylesheet" href="/static/css/main.css">
  
</head>
<body>
  <div class="app-shell">
    <header class="topbar" data-topbar>
      <div class="topbar__content">
        <button class="topbar__burger" type="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" aria-expanded="false" data-topbar-toggle>
          <span aria-hidden="true">‚ò∞</span>
        </button>
        <a class="topbar__brand" href="/">
          <span>TG</span>
          Bot Admin
        </a>
        <nav class="topbar__nav" data-topbar-nav aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
          <ul class="nav-links">
            <li class="nav-links__item">
              <a href="/" class="nav-link">–î–∞—à–±–æ—Ä–¥</a>
            </li>
            <li class="nav-links__item">
              <a href="/recruiters" class="nav-link">–†–µ–∫—Ä—É—Ç—ë—Ä—ã</a>
            </li>
            <li class="nav-links__item">
              <a href="/cities" class="nav-link">–ì–æ—Ä–æ–¥–∞</a>
            </li>
            <li class="nav-links__item">
              <a href="/slots" class="nav-link" aria-current="page">–°–ª–æ—Ç—ã</a>
            </li>
            <li class="nav-links__item">
              <a href="/candidates" class="nav-link">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</a>
            </li>
            <li class="nav-links__item">
              <a href="/templates" class="nav-link">–®–∞–±–ª–æ–Ω—ã</a>
            </li>
            <li class="nav-links__item">
              <a href="/questions" class="nav-link">–í–æ–ø—Ä–æ—Å—ã</a>
            </li>
          </ul>
        </nav>
        <div class="topbar__actions">
          <button id="theme-toggle" class="theme-toggle" type="button" aria-pressed="false" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
            <span class="theme-toggle__icon" aria-hidden="true">üåô</span>
            <span class="theme-toggle__label">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
          </button>
          <span class="topbar__badge">demo.local</span>
        </div>
      </div>
    </header>
    <div class="topbar__scrim" data-topbar-scrim></div>
    <main class="app-main">
      <div class="container">
        

<section class="page page--slots" data-page="slots" aria-labelledby="slots-title">
  <header class="page-header">
    <div>
      <h1 id="slots-title" class="page-title">–°–ª–æ—Ç—ã</h1>
      <p class="page-description">
        –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä–≤—å—é: —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –ø–æ —Ä–µ–∫—Ä—É—Ç—ë—Ä–∞–º –∏ —Å—Ç–∞—Ç—É—Å—É, –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ—Å—å –º–µ–∂–¥—É –±—É–¥—É—â–∏–º–∏ –∏ –ø—Ä–æ—à–µ–¥—à–∏–º–∏ —Å–ª–æ—Ç–∞–º–∏, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏.
      </p>
    </div>
    <div class="page-actions">
      <a class="btn btn-primary" href="/slots/new">+ –ù–æ–≤—ã–π —Å–ª–æ—Ç</a>
      <button type="button" class="btn btn-danger" id="delete_all_slots">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ</button>
    </div>
  </header>

  

  <section class="slot-summary" aria-label="–ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–ª–æ—Ç–∞–º">
    <article class="slot-summary__item" data-tone="success">
      <span class="slot-summary__label">–°–≤–æ–±–æ–¥–Ω—ã–µ</span>
      <span class="slot-summary__value" id="cnt-free">8</span>
      <p class="slot-summary__hint">–ì–æ—Ç–æ–≤—ã –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</p>
    </article>
    <article class="slot-summary__item" data-tone="warning">
      <span class="slot-summary__label">–û–∂–∏–¥–∞—é—Ç</span>
      <span class="slot-summary__value" id="cnt-pending">5</span>
      <p class="slot-summary__hint">–ó–∞—è–≤–∫–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
    </article>
    <article class="slot-summary__item" data-tone="info">
      <span class="slot-summary__label">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω—ã</span>
      <span class="slot-summary__value" id="cnt-booked">9</span>
      <p class="slot-summary__hint">–ò–Ω—Ç–µ—Ä–≤—å—é –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º</p>
    </article>
    <article class="slot-summary__item" data-tone="primary">
      <span class="slot-summary__label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã</span>
      <span class="slot-summary__value" id="cnt-confirmed">2</span>
      <p class="slot-summary__hint">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —É—á–∞—Å—Ç–∏–µ</p>
    </article>
    <article class="slot-summary__item" data-tone="neutral">
      <span class="slot-summary__label">–í—Å–µ–≥–æ</span>
      <span class="slot-summary__value" id="cnt-total">24</span>
      <p class="slot-summary__hint">–° —É—á—ë—Ç–æ–º –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤</p>
    </article>
  </section>

  
  
  
  
  <section class="list-toolbar glass-card list-toolbar--sticky">
    <form id="slot_filters" class="list-toolbar__form" action="/slots" method="get" >
      <div class="list-toolbar__filters">
        
    <div class="form-field">
      <label for="recruiter_id">–†–µ–∫—Ä—É—Ç—ë—Ä</label>
      <select id="recruiter_id" name="recruiter_id">
        <option value="">‚Äî –í—Å–µ ‚Äî</option>
        
          <option value="10" >
            –ê–ª–µ–∫—Å–µ–π –ó–∞—Ö–∞—Ä–æ–≤ (UTC+03:00 (Europe/Moscow))
          </option>
        
          <option value="11" >
            –ú–∞—Ä–∏—è –û—Ä–ª–æ–≤–∞ (UTC+04:00 (Europe/Samara))
          </option>
        
      </select>
    </div>

    <div class="form-field form-field--narrow">
      <label for="status">–°—Ç–∞—Ç—É—Å</label>
      <select id="status" name="status">
        <option value="">‚Äî –í—Å–µ ‚Äî</option>
        <option value="FREE" >FREE</option>
        <option value="PENDING" >PENDING</option>
        <option value="BOOKED" >BOOKED</option>
        <option value="CONFIRMED_BY_CANDIDATE" >CONFIRMED_BY_CANDIDATE</option>
      </select>
    </div>

    <div class="form-field form-field--narrow">
      <label for="per_page">–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</label>
      <select id="per_page" name="per_page">
        
          <option value="10" >10</option>
        
          <option value="20" selected>20</option>
        
          <option value="50" >50</option>
        
          <option value="100" >100</option>
        
      </select>
    </div>

    <p class="slot-toolbar-note">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã –Ω–∏–∂–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ.</p>
  
      </div>
      
        <div class="list-toolbar__mass">
          
            
  
  
  
  
  
  
  
  
  
    <button type="submit" class="btn btn-primary" >
      
      –ü–æ–∫–∞–∑–∞—Ç—å
    </button>
  

          
        </div>
      
      
    </form>
    
  </section>


  <div class="slot-toggle-bar" role="group" aria-label="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è">
    <label class="slot-toggle">
      <input id="only_future" type="checkbox" autocomplete="off">
      <span class="slot-toggle__indicator" aria-hidden="true"></span>
      <span class="slot-toggle__label">–¢–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ —Å–ª–æ—Ç—ã</span>
    </label>
    <label class="slot-toggle">
      <input id="toggle_cand_tz" type="checkbox" autocomplete="off">
      <span class="slot-toggle__indicator" aria-hidden="true"></span>
      <span class="slot-toggle__label">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</span>
    </label>
  </div>

  
    <div class="list-table-wrapper">
      <table class="list-table list-table--responsive slot-table" id="slots_table">
        <thead>
          <tr>
            <th scope="col" class="sortable">
              <button class="sort" type="button" data-key="id" aria-sort="ascending">ID <span class="arrow" aria-hidden="true"></span></button>
            </th>
            <th scope="col" class="sortable">
              <button class="sort" type="button" data-key="recruiter" aria-sort="none">–†–µ–∫—Ä—É—Ç—ë—Ä <span class="arrow" aria-hidden="true"></span></button>
            </th>
            <th scope="col" class="sortable">
              <button class="sort" type="button" data-key="utc" aria-sort="none">UTC <span class="arrow" aria-hidden="true"></span></button>
            </th>
            <th scope="col">–õ–æ–∫–∞–ª—å–Ω–æ–µ (TZ —Ä–µ–∫—Ä—É—Ç—ë—Ä–∞)</th>
            <th scope="col" class="col-cand-tz is-optional">–õ–æ–∫–∞–ª—å–Ω–æ–µ (TZ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞)</th>
            <th scope="col" class="sortable">
              <button class="sort" type="button" data-key="status" aria-sort="none">–°—Ç–∞—Ç—É—Å <span class="arrow" aria-hidden="true"></span></button>
            </th>
            <th scope="col" class="sortable is-optional">
              <button class="sort" type="button" data-key="candidate" aria-sort="none">–ö–∞–Ω–¥–∏–¥–∞—Ç <span class="arrow" aria-hidden="true"></span></button>
            </th>
            <th scope="col" class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="slots_tbody">
        
          
          
          
          
          <tr class="slot-row"
              tabindex="0"
              data-id="301"
              data-status="FREE"
              data-status-order="0"
              data-start-iso="2025-10-11T12:08:52.850266+00:00"
              data-start-utc="11.10.2025 12:08"
              data-start-rec="11.10.2025 15:08"
              data-start-cand=""
              data-recruiter="–ê–ª–µ–∫—Å–µ–π –ó–∞—Ö–∞—Ä–æ–≤"
              data-recruiter-id="10"
              data-recruiter-tz="Europe/Moscow"
              data-duration="45"
              data-candidate=""
              data-candidate-id=""
              data-candidate-tz=""
              data-outcome=""
              data-can-delete="1">
            <td data-label="ID">ID 301</td>
            <td data-label="–†–µ–∫—Ä—É—Ç—ë—Ä">
              <div class="slot-cell-primary">–ê–ª–µ–∫—Å–µ–π –ó–∞—Ö–∞—Ä–æ–≤</div>
              <span class="badge badge--soft">UTC+03:00 (Europe/Moscow)</span>
            </td>
            <td data-label="UTC">
              <div class="slot-time">
                <span class="slot-time__value">11.10.2025 12:08</span>
                <span class="slot-time__relative" data-role="relative">‚Äî</span>
              </div>
            </td>
            <td data-label="–í—Ä–µ–º—è (—Ä–µ–∫—Ä—É—Ç—ë—Ä)">
              <span class="slot-time__value">11.10.2025 15:08</span>
            </td>
            <td data-label="–í—Ä–µ–º—è (–∫–∞–Ω–¥–∏–¥–∞—Ç)" class="col-cand-tz is-optional">
              
                <span class="badge badge--soft">‚Äî</span>
              
            </td>
            <td data-label="–°—Ç–∞—Ç—É—Å">
              
                <span class="status-badge" data-tone="success">FREE</span>
              
            </td>
            <td data-label="–ö–∞–Ω–¥–∏–¥–∞—Ç" class="is-optional">
              
                <span class="badge badge--soft">‚Äî</span>
              
            </td>
            <td class="col-actions" data-label="–î–µ–π—Å—Ç–≤–∏—è">
              <button type="button" class="btn btn-soft btn--small" data-action="open-slot">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
              <button type="button"
                      class="btn btn-danger btn--small"
                      data-action="delete-slot">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </td>
          </tr>
        
          
          
          
          
          <tr class="slot-row"
              tabindex="0"
              data-id="302"
              data-status="BOOKED"
              data-status-order="2"
              data-start-iso="2025-10-12T14:08:52.850266+00:00"
              data-start-utc="12.10.2025 14:08"
              data-start-rec="12.10.2025 17:08"
              data-start-cand="12.10.2025 17:08"
              data-recruiter="–ê–ª–µ–∫—Å–µ–π –ó–∞—Ö–∞—Ä–æ–≤"
              data-recruiter-id="10"
              data-recruiter-tz="Europe/Moscow"
              data-duration="45"
              data-candidate="–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞"
              data-candidate-id="438201239"
              data-candidate-tz="Europe/Moscow"
              data-outcome=""
              data-can-delete="0">
            <td data-label="ID">ID 302</td>
            <td data-label="–†–µ–∫—Ä—É—Ç—ë—Ä">
              <div class="slot-cell-primary">–ê–ª–µ–∫—Å–µ–π –ó–∞—Ö–∞—Ä–æ–≤</div>
              <span class="badge badge--soft">UTC+03:00 (Europe/Moscow)</span>
            </td>
            <td data-label="UTC">
              <div class="slot-time">
                <span class="slot-time__value">12.10.2025 14:08</span>
                <span class="slot-time__relative" data-role="relative">‚Äî</span>
              </div>
            </td>
            <td data-label="–í—Ä–µ–º—è (—Ä–µ–∫—Ä—É—Ç—ë—Ä)">
              <span class="slot-time__value">12.10.2025 17:08</span>
            </td>
            <td data-label="–í—Ä–µ–º—è (–∫–∞–Ω–¥–∏–¥–∞—Ç)" class="col-cand-tz is-optional">
              
                <div class="badge badge--soft">UTC+03:00 (Europe/Moscow)</div>
                <span class="slot-time__value">12.10.2025 17:08</span>
              
            </td>
            <td data-label="–°—Ç–∞—Ç—É—Å">
              
                <span class="status-badge" data-tone="info">BOOKED</span>
              
            </td>
            <td data-label="–ö–∞–Ω–¥–∏–¥–∞—Ç" class="is-optional">
              
                <div class="slot-cell-primary">–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞</div>
                <span class="badge badge--soft">tg_id: 438201239</span>
              
            </td>
            <td class="col-actions" data-label="–î–µ–π—Å—Ç–≤–∏—è">
              <button type="button" class="btn btn-soft btn--small" data-action="open-slot">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
              <button type="button"
                      class="btn btn-danger btn--small"
                      data-action="delete-slot">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </td>
          </tr>
        
          
          
          
          
          <tr class="slot-row"
              tabindex="0"
              data-id="303"
              data-status="PENDING"
              data-status-order="1"
              data-start-iso="2025-10-11T16:08:52.850266+00:00"
              data-start-utc="11.10.2025 16:08"
              data-start-rec="11.10.2025 20:08"
              data-start-cand="11.10.2025 19:08"
              data-recruiter="–ú–∞—Ä–∏—è –û—Ä–ª–æ–≤–∞"
              data-recruiter-id="11"
              data-recruiter-tz="Europe/Samara"
              data-duration="30"
              data-candidate="–ï–≥–æ—Ä –ö—Ä–∞–≤—Ü–æ–≤"
              data-candidate-id="522118002"
              data-candidate-tz="Europe/Moscow"
              data-outcome=""
              data-can-delete="1">
            <td data-label="ID">ID 303</td>
            <td data-label="–†–µ–∫—Ä—É—Ç—ë—Ä">
              <div class="slot-cell-primary">–ú–∞—Ä–∏—è –û—Ä–ª–æ–≤–∞</div>
              <span class="badge badge--soft">UTC+04:00 (Europe/Samara)</span>
            </td>
            <td data-label="UTC">
              <div class="slot-time">
                <span class="slot-time__value">11.10.2025 16:08</span>
                <span class="slot-time__relative" data-role="relative">‚Äî</span>
              </div>
            </td>
            <td data-label="–í—Ä–µ–º—è (—Ä–µ–∫—Ä—É—Ç—ë—Ä)">
              <span class="slot-time__value">11.10.2025 20:08</span>
            </td>
            <td data-label="–í—Ä–µ–º—è (–∫–∞–Ω–¥–∏–¥–∞—Ç)" class="col-cand-tz is-optional">
              
                <div class="badge badge--soft">UTC+03:00 (Europe/Moscow)</div>
                <span class="slot-time__value">11.10.2025 19:08</span>
              
            </td>
            <td data-label="–°—Ç–∞—Ç—É—Å">
              
                <span class="status-badge" data-tone="warning">PENDING</span>
              
            </td>
            <td data-label="–ö–∞–Ω–¥–∏–¥–∞—Ç" class="is-optional">
              
                <div class="slot-cell-primary">–ï–≥–æ—Ä –ö—Ä–∞–≤—Ü–æ–≤</div>
                <span class="badge badge--soft">tg_id: 522118002</span>
              
            </td>
            <td class="col-actions" data-label="–î–µ–π—Å—Ç–≤–∏—è">
              <button type="button" class="btn btn-soft btn--small" data-action="open-slot">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
              <button type="button"
                      class="btn btn-danger btn--small"
                      data-action="delete-slot">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </td>
          </tr>
        
        </tbody>
      </table>
    </div>

    <div class="pagination">
      
      
      

      <span class="badge badge--soft">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>

      
        <span class="btn btn-ghost" aria-disabled="true">¬´ –ü–µ—Ä–≤–∞—è</span>
        <span class="btn btn-ghost" aria-disabled="true">‚Äπ –ù–∞–∑–∞–¥</span>
      

      
        <span class="btn btn-ghost" aria-disabled="true">–í–ø–µ—Ä—ë–¥ ‚Ä∫</span>
        <span class="btn btn-ghost" aria-disabled="true">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</span>
      
    </div>
  

  <div id="slot_backdrop" class="sheet-backdrop" hidden></div>
  <aside id="slot_sheet" class="sheet slot-drawer" hidden aria-modal="true" role="dialog" aria-labelledby="slot_sheet_title">
    <header class="sheet-header">
      <div>
        <h3 id="slot_sheet_title" class="sheet-title">–°–ª–æ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</h3>
        <p id="slot_sheet_sub" class="sheet-sub muted">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ.</p>
      </div>
      <button id="slot_sheet_close" class="btn btn-ghost btn--small" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    </header>

    <div class="sheet-body slot-sheet-body">
      <section class="slot-overview" aria-live="polite">
        <div class="slot-overview__top">
          <span class="badge badge--soft" id="slot_sheet_id">ID ‚Äî</span>
          <span class="status-badge" id="slot_sheet_status" data-tone="info">–°—Ç–∞—Ç—É—Å: ‚Äî</span>
        </div>
        <div class="slot-overview__meta">
          <div>
            <span class="slot-overview__hint">UTC</span>
            <p class="slot-overview__value" id="slot_sheet_utc">‚Äî</p>
          </div>
          <div>
            <span class="slot-overview__hint">–õ–æ–∫–∞–ª—å–Ω–æ–µ (—Ä–µ–∫—Ä—É—Ç—ë—Ä)</span>
            <p class="slot-overview__value" id="slot_sheet_local">‚Äî</p>
          </div>
          <div id="slot_sheet_local_candidate_wrap">
            <span class="slot-overview__hint">–õ–æ–∫–∞–ª—å–Ω–æ–µ (–∫–∞–Ω–¥–∏–¥–∞—Ç)</span>
            <p class="slot-overview__value" id="slot_sheet_local_candidate">‚Äî</p>
          </div>
        </div>
        <p class="slot-overview__rel" id="slot_sheet_rel">‚Äî</p>
      </section>

      <section class="slot-panel">
        <div class="slot-panel__header">
          <span class="slot-panel__icon" aria-hidden="true">üßë‚Äçüíº</span>
          <div>
            <h4 class="slot-panel__title">–†–µ–∫—Ä—É—Ç—ë—Ä</h4>
            <p class="slot-panel__hint">–¢–µ–∫—É—â–∏–π –≤–ª–∞–¥–µ–ª–µ—Ü —Å–ª–æ—Ç–∞</p>
          </div>
        </div>
        <div class="slot-panel__body" id="slot_sheet_recruiter">
          <p class="muted">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</p>
        </div>
      </section>

      <section class="slot-panel" id="slot_sheet_candidate_section">
        <div class="slot-panel__header">
          <span class="slot-panel__icon" aria-hidden="true">üßë‚Äçüéì</span>
          <div>
            <h4 class="slot-panel__title">–ö–∞–Ω–¥–∏–¥–∞—Ç</h4>
            <p class="slot-panel__hint">–ë—Ä–æ–Ω—å –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</p>
          </div>
        </div>
        <div class="slot-panel__body" id="slot_sheet_candidate">
          <p class="muted">–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª —Å–ª–æ—Ç.</p>
        </div>
        <div class="slot-panel__actions" id="slot_sheet_candidate_actions">
          <button type="button" class="btn btn-soft btn--small" id="slot_reschedule_btn" disabled>–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±—Ä–æ–Ω—å</button>
          <button type="button" class="btn btn-danger btn--small" id="slot_reject_btn" disabled>–û—Ç–∫–∞–∑–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç—É</button>
        </div>
      </section>

      <section class="slot-panel" id="slot_sheet_outcome_section">
        <div class="slot-panel__header">
          <span class="slot-panel__icon" aria-hidden="true">‚úÖ</span>
          <div>
            <h4 class="slot-panel__title">–ò—Å—Ö–æ–¥ –∏–Ω—Ç–µ—Ä–≤—å—é</h4>
            <p class="slot-panel__hint">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å—Ç—Ä–µ—á–∏</p>
          </div>
        </div>
        <div class="slot-panel__body">
          <p class="muted" id="slot_sheet_outcome_hint">–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.</p>
          <div class="slot-outcome__actions" id="slot_sheet_outcome_actions">
            <button type="button" class="btn btn-ghost btn--small" data-outcome="success">–ü—Ä–æ—à—ë–ª</button>
            <button type="button" class="btn btn-ghost btn--small" data-outcome="reject">–ù–µ –ø—Ä–æ—à—ë–ª</button>
          </div>
          <p class="slot-outcome__status" id="slot_sheet_outcome_status">–ò—Å—Ö–æ–¥ –Ω–µ –≤—ã–±—Ä–∞–Ω</p>
        </div>
      </section>

      <section class="slot-panel">
        <div class="slot-panel__header">
          <span class="slot-panel__icon" aria-hidden="true">‚è±</span>
          <div>
            <h4 class="slot-panel__title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h4>
            <p class="slot-panel__hint">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞—Ç—É—Å</p>
          </div>
        </div>
        <div class="slot-panel__body">
          <ul class="slot-meta" id="slot_sheet_meta"></ul>
        </div>
      </section>
    </div>

    <footer class="sheet-footer slot-sheet-footer">
      <div class="form-actions">
        <button id="slot_delete_btn" class="btn btn-danger btn--small" type="button" disabled>–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç</button>
        <a class="btn btn-primary" href="/slots/new">+ –ù–æ–≤—ã–π —Å–ª–æ—Ç</a>
      </div>
    </footer>
  </aside>

  <div id="toasts" class="toast-stack" aria-live="polite" aria-atomic="true"></div>
</section>

<script>
(function(){
  const $ = (selector, root=document) => root.querySelector(selector);
  const $$ = (selector, root=document) => Array.from(root.querySelectorAll(selector));
  const on = (el, event, cb, opts) => el && el.addEventListener(event, cb, opts);

  const table = $('#slots_table');
  const tbody = $('#slots_tbody');
  const rows = tbody ? $$('.slot-row', tbody) : [];

  const onlyFuture = $('#only_future');
  const candToggle = $('#toggle_cand_tz');
  const emptyCard = $('#slot_empty_state');
  const deleteAllBtn = $('#delete_all_slots');

  const chipTotal = $('#cnt-total');
  const chipFree = $('#cnt-free');
  const chipPending = $('#cnt-pending');
  const chipBookedEl = $('#cnt-booked');

  const slotSheet = $('#slot_sheet');
  const slotBackdrop = $('#slot_backdrop');
  const slotClose = $('#slot_sheet_close');

  const slotTitle = $('#slot_sheet_title');
  const slotSub = $('#slot_sheet_sub');
  const slotId = $('#slot_sheet_id');
  const slotStatus = $('#slot_sheet_status');
  const slotUtc = $('#slot_sheet_utc');
  const slotLocal = $('#slot_sheet_local');
  const slotLocalCandidateWrap = $('#slot_sheet_local_candidate_wrap');
  const slotLocalCandidate = $('#slot_sheet_local_candidate');
  const slotRel = $('#slot_sheet_rel');
  const slotRecruiter = $('#slot_sheet_recruiter');
  const slotCandidateSection = $('#slot_sheet_candidate_section');
  const slotCandidate = $('#slot_sheet_candidate');
  const slotCandidateActions = $('#slot_sheet_candidate_actions');
  const slotRescheduleBtn = $('#slot_reschedule_btn');
  const slotRejectBookingBtn = $('#slot_reject_btn');
  const slotOutcomeSection = $('#slot_sheet_outcome_section');
  const slotOutcomeHint = $('#slot_sheet_outcome_hint');
  const slotOutcomeActions = $('#slot_sheet_outcome_actions');
  const slotOutcomeStatus = $('#slot_sheet_outcome_status');
  const slotMeta = $('#slot_sheet_meta');
  const slotDeleteBtn = $('#slot_delete_btn');
  const toastStack = $('#toasts');

  let sortState = { key: 'utc', dir: 'asc' };
  let currentRow = null;
  let relTimer = null;

  const storage = window.localStorage;
  const storageKeys = {
    future: 'slots.onlyFuture',
    candidate: 'slots.showCandidateTz'
  };

  function toast(text, kind='info'){
    if (!toastStack) return;
    const el = document.createElement('div');
    el.className = 'toast';
    el.dataset.kind = kind;
    el.textContent = text;
    toastStack.appendChild(el);
    requestAnimationFrame(() => el.classList.add('toast--show'));
    setTimeout(() => el.classList.add('toast--hide'), 1800);
    setTimeout(() => el.remove(), 2200);
  }

  function parseTime(row){
    const iso = row?.dataset.startIso;
    if (!iso) return NaN;
    const value = Date.parse(iso);
    return Number.isNaN(value) ? NaN : value;
  }

  function isFutureRow(row){
    const ts = parseTime(row);
    return Number.isNaN(ts) ? true : ts >= Date.now();
  }

  function formatRelative(timestamp){
    if (!Number.isFinite(timestamp)) return '‚Äî';
    const diffMin = Math.round((timestamp - Date.now()) / 60000);
    const abs = Math.abs(diffMin);
    if (abs < 1) return diffMin >= 0 ? '—á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥' : '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
    if (abs < 60) return `${diffMin >= 0 ? '—á–µ—Ä–µ–∑' : ''} ${abs} –º–∏–Ω`;
    const hours = Math.round(abs / 60);
    return `${diffMin >= 0 ? '—á–µ—Ä–µ–∑' : ''} ${hours} —á`;
  }

  function updateCounters(result){
    if (!result) result = computeVisibleStats();
    if (chipTotal) chipTotal.textContent = result.total;
    if (chipFree) chipFree.textContent = result.free;
    if (chipPending) chipPending.textContent = result.pending;
    if (chipBookedEl) chipBookedEl.textContent = result.booked;
  }

  function computeVisibleStats(){
    let total = 0, free = 0, pending = 0, booked = 0;
    rows.forEach(row => {
      if (row.style.display === 'none') return;
      total += 1;
      const st = row.dataset.status;
      if (st === 'FREE') free += 1;
      else if (st === 'PENDING') pending += 1;
      else if (st === 'BOOKED') booked += 1;
    });
    return { total, free, pending, booked };
  }

  function applyFutureFilter(){
    const onlyFutureEnabled = onlyFuture && onlyFuture.checked;
    let visible = 0;
    rows.forEach(row => {
      const show = !onlyFutureEnabled || isFutureRow(row);
      row.style.display = show ? '' : 'none';
      row.classList.toggle('is-hidden', !show);
      if (show) visible += 1;
    });
    updateCounters();
    toggleEmptyState(visible);
  }

  function toggleEmptyState(visibleCount){
    if (!emptyCard) return;
    if (!rows.length){
      emptyCard.hidden = false;
      return;
    }
    emptyCard.hidden = visibleCount > 0;
  }

  function setCandidateColumnVisibility(show){
    const targets = $$('.col-cand-tz');
    targets.forEach(el => el.classList.toggle('hidden-col', !show));
  }

  function getSortValue(row, key){
    switch(key){
      case 'id':
        return parseInt(row.dataset.id || '0', 10);
      case 'utc':
        return parseTime(row);
      case 'recruiter':
        return (row.dataset.recruiter || '').toLowerCase();
      case 'candidate':
        return (row.dataset.candidate || '').toLowerCase();
      case 'status':
        return parseInt(row.dataset.statusOrder || '9', 10);
      default:
        return 0;
    }
  }

  function applySortIndicator(){
    if (!table) return;
    $$('.sort', table).forEach(btn => {
      const key = btn.dataset.key;
      const active = key === sortState.key;
      btn.classList.toggle('is-active', active);
      btn.setAttribute('aria-sort', active ? (sortState.dir === 'asc' ? 'ascending' : 'descending') : 'none');
    });
  }

  function applySort(){
    if (!tbody) return;
    const sorted = rows.slice().sort((a, b) => {
      const av = getSortValue(a, sortState.key);
      const bv = getSortValue(b, sortState.key);
      if (av < bv) return sortState.dir === 'asc' ? -1 : 1;
      if (av > bv) return sortState.dir === 'asc' ? 1 : -1;
      return 0;
    });
    sorted.forEach(row => tbody.appendChild(row));
  }

  function updateRelativeLabels(){
    rows.forEach(row => {
      const relEl = $('[data-role="relative"]', row);
      if (!relEl) return;
      relEl.textContent = formatRelative(parseTime(row));
    });
    if (currentRow && slotRel){
      slotRel.textContent = formatRelative(parseTime(currentRow));
    }
  }

  function fillList(container, items){
    container.innerHTML = '';
    items.forEach(text => {
      const li = document.createElement('li');
      li.textContent = text;
      container.appendChild(li);
    });
  }

  function removeRow(row){
    if (!row) return;
    const idx = rows.indexOf(row);
    if (idx !== -1){
      rows.splice(idx, 1);
    }
    row.remove();
  }

  function openSheet(){
    if (!slotSheet || !slotBackdrop) return;
    slotSheet.hidden = false;
    slotBackdrop.hidden = false;
    requestAnimationFrame(() => {
      slotSheet.classList.add('open');
      slotBackdrop.classList.add('open');
      document.body.classList.add('sheet-open');
    });
  }

  function closeSheet(){
    if (!slotSheet || !slotBackdrop) return;
    slotSheet.classList.remove('open');
    slotBackdrop.classList.remove('open');
    setTimeout(() => {
      slotSheet.hidden = true;
      slotBackdrop.hidden = true;
      document.body.classList.remove('sheet-open');
      currentRow = null;
      resetSheet();
    }, 200);
  }

  function resetSheet(){
    if (slotTitle) slotTitle.textContent = '–°–ª–æ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω';
    if (slotSub) slotSub.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ.';
    if (slotId) slotId.textContent = 'ID ‚Äî';
    if (slotStatus){
      slotStatus.textContent = '–°—Ç–∞—Ç—É—Å: ‚Äî';
      slotStatus.dataset.tone = 'info';
    }
    if (slotUtc) slotUtc.textContent = '‚Äî';
    if (slotLocal) slotLocal.textContent = '‚Äî';
    if (slotLocalCandidateWrap){
      slotLocalCandidateWrap.hidden = true;
    }
    if (slotRel) slotRel.textContent = '‚Äî';
    if (slotRecruiter) slotRecruiter.innerHTML = '<p class="muted">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</p>';
    if (slotCandidateSection){
      slotCandidateSection.hidden = true;
    }
    if (slotCandidate) slotCandidate.innerHTML = '';
    if (slotOutcomeSection){
      slotOutcomeSection.hidden = true;
    }
    if (slotOutcomeHint){
      slotOutcomeHint.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.';
    }
    if (slotOutcomeStatus){
      slotOutcomeStatus.textContent = '–ò—Å—Ö–æ–¥ –Ω–µ –≤—ã–±—Ä–∞–Ω';
    }
    if (slotOutcomeActions){
      $$('button', slotOutcomeActions).forEach(btn => {
        btn.disabled = true;
        btn.classList.remove('is-active');
      });
    }
    if (slotMeta) slotMeta.innerHTML = '';
    if (slotDeleteBtn){
      slotDeleteBtn.disabled = true;
      slotDeleteBtn.dataset.slotId = '';
      slotDeleteBtn.dataset.forceAllowed = '0';
      slotDeleteBtn.textContent = '–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç';
    }
  }

  function toneForStatus(status){
    if (status === 'FREE') return 'success';
    if (status === 'PENDING') return 'warning';
    if (status === 'BOOKED') return 'info';
    return 'neutral';
  }

  function normalizeOutcome(raw){
    const value = (raw || '').toLowerCase();
    if (value === 'passed' || value === 'success') return 'success';
    if (value === 'failed' || value === 'reject') return 'reject';
    return '';
  }

  function setOutcomeButtonsEnabled(enabled){
    if (!slotOutcomeActions) return;
    $$('button', slotOutcomeActions).forEach(btn => {
      btn.disabled = !enabled;
    });
  }

  function updateOutcomeUI(outcome){
    if (!slotOutcomeStatus || !slotOutcomeActions) return;
    const normalized = normalizeOutcome(outcome);
    $$('button', slotOutcomeActions).forEach(btn => {
      btn.classList.toggle('is-active', btn.dataset.outcome === normalized);
    });
    if (!normalized){
      slotOutcomeStatus.textContent = '–ò—Å—Ö–æ–¥ –Ω–µ –≤—ã–±—Ä–∞–Ω';
      return;
    }
    slotOutcomeStatus.textContent = normalized === 'success'
      ? '–ö–∞–Ω–¥–∏–¥–∞—Ç –ø—Ä–æ—à—ë–ª –∏–Ω—Ç–µ—Ä–≤—å—é'
      : '–ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –ø—Ä–æ—à—ë–ª –∏–Ω—Ç–µ—Ä–≤—å—é';
  }

  function hydrateSheet(row){
    const id = row.dataset.id || '‚Äî';
    const status = row.dataset.status || '‚Äî';
    const recruiterName = row.dataset.recruiter || '‚Äî';
    const recruiterTz = row.dataset.recruiterTz || 'Europe/Moscow';
    const candidateName = row.dataset.candidate || '';
    const candidateTz = row.dataset.candidateTz || '';
    const candidateId = row.dataset.candidateId || '';
    const duration = parseInt(row.dataset.duration || '0', 10);
    const outcome = normalizeOutcome(row.dataset.outcome || '');

    if (slotTitle) slotTitle.textContent = recruiterName ? `–°–ª–æ—Ç —É ${recruiterName}` : `–°–ª–æ—Ç #${id}`;
    if (slotSub) slotSub.textContent = `ID: ${id}`;
    if (slotId) slotId.textContent = `ID ${id}`;
    if (slotStatus){
      slotStatus.textContent = `–°—Ç–∞—Ç—É—Å: ${status}`;
      slotStatus.dataset.tone = toneForStatus(status);
    }
    if (slotUtc) slotUtc.textContent = row.dataset.startUtc || '‚Äî';
    if (slotLocal) slotLocal.textContent = row.dataset.startRec || '‚Äî';
    if (slotLocalCandidateWrap){
      if (candidateTz && row.dataset.startCand){
        slotLocalCandidateWrap.hidden = false;
        if (slotLocalCandidate) slotLocalCandidate.textContent = `${row.dataset.startCand} (${candidateTz})`;
      } else {
        slotLocalCandidateWrap.hidden = true;
      }
    }
    if (slotRel) slotRel.textContent = formatRelative(parseTime(row));

    if (slotRecruiter){
      slotRecruiter.innerHTML = `
        <div class="slot-person">
          <span class="slot-person__name">${recruiterName || '‚Äî'}</span>
          <span class="badge badge--soft">${recruiterTz}</span>
        </div>`;
    }

    if (slotCandidateSection){
      if (candidateName){
        slotCandidateSection.hidden = false;
        if (slotCandidate){
          slotCandidate.innerHTML = `
            <div class="slot-person">
              <span class="slot-person__name">${candidateName}</span>
              ${candidateTz ? `<span class="badge badge--soft">${candidateTz}</span>` : ''}
            </div>
            <p class="muted">tg_id: ${candidateId || '‚Äî'}</p>`;
        }
        if (slotCandidateActions) slotCandidateActions.hidden = false;
      } else {
        slotCandidateSection.hidden = false;
        if (slotCandidate) slotCandidate.innerHTML = '<p class="muted">–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª —Å–ª–æ—Ç.</p>';
        if (slotCandidateActions) slotCandidateActions.hidden = true;
      }
    }

    if (slotRescheduleBtn){
      slotRescheduleBtn.disabled = !candidateName;
      slotRescheduleBtn.dataset.slotId = id || '';
    }
    if (slotRejectBookingBtn){
      slotRejectBookingBtn.disabled = !candidateName;
      slotRejectBookingBtn.dataset.slotId = id || '';
    }

    if (slotOutcomeSection){
      slotOutcomeSection.hidden = false;
      const hasCandidate = !!(candidateName && candidateName.trim().length);
      if (slotOutcomeHint){
        slotOutcomeHint.textContent = hasCandidate
          ? '–û—Ç–º–µ—Ç—å—Ç–µ –∏—Å—Ö–æ–¥. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ ¬´–ü—Ä–æ—à—ë–ª¬ª –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –¢–µ—Å—Ç 2.'
          : '–ù–∞–∑–Ω–∞—á—å—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –∏—Å—Ö–æ–¥.';
      }
      setOutcomeButtonsEnabled(hasCandidate);
      if (hasCandidate){
        updateOutcomeUI(outcome);
      } else if (slotOutcomeStatus){
        slotOutcomeStatus.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ ‚Äî –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω';
        if (slotOutcomeActions){
          $$('button', slotOutcomeActions).forEach(btn => btn.classList.remove('is-active'));
        }
      }
    }

    row.dataset.outcome = outcome;

    if (slotMeta){
      const items = [];
      items.push(`–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration || 60} –º–∏–Ω`);
      items.push(`UTC: ${row.dataset.startUtc || '‚Äî'}`);
      items.push(`TZ —Ä–µ–∫—Ä—É—Ç—ë—Ä–∞: ${recruiterTz}`);
      if (candidateTz) items.push(`TZ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞: ${candidateTz}`);
      fillList(slotMeta, items);
    }

    if (slotDeleteBtn){
      const canDelete = row.dataset.canDelete === '1';
      slotDeleteBtn.disabled = false;
      slotDeleteBtn.dataset.slotId = id;
      slotDeleteBtn.dataset.status = status;
      slotDeleteBtn.dataset.recruiter = recruiterName || '';
      slotDeleteBtn.dataset.forceAllowed = canDelete ? '0' : '1';
      slotDeleteBtn.textContent = canDelete ? '–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç' : '–£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ';
    }

  }

  async function submitOutcome(outcome){
    if (!currentRow) return;
    if (!slotOutcomeActions) return;
    const slotId = currentRow.dataset.id;
    if (!slotId) return;
    const hasCandidate = !!(currentRow.dataset.candidate && currentRow.dataset.candidate.trim().length);
    if (!hasCandidate){
      toast('–ù–∞–∑–Ω–∞—á—å—Ç–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –∏—Å—Ö–æ–¥.', 'warning');
      return;
    }

    setOutcomeButtonsEnabled(false);
    try {
      const response = await fetch(`/slots/${slotId}/outcome`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ outcome })
      });
      let data = {};
      try {
        data = await response.json();
      } catch (err) {
        data = {};
      }
      if (!response.ok || !data.ok){
        toast((data && data.message) || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ö–æ–¥.', 'error');
        return;
      }
      const stored = normalizeOutcome(data.outcome || outcome);
      currentRow.dataset.outcome = stored;
      updateOutcomeUI(stored);
      toast((data && data.message) || '–ò—Å—Ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω.', 'success');
    } catch (err){
      console.error(err);
      toast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ö–æ–¥.', 'error');
    } finally {
      const stillHasCandidate = !!(currentRow && currentRow.dataset.candidate && currentRow.dataset.candidate.trim().length);
      setOutcomeButtonsEnabled(stillHasCandidate);
    }
  }

  function openSlot(row){
    if (!row) return;
    currentRow = row;
    hydrateSheet(row);
    openSheet();
  }

  async function performDelete(row, options = {}){
    if (!row) return;
    const { force = false, skipConfirm = false } = options;
    const id = row.dataset.id;
    if (!id) return;

    const canDelete = row.dataset.canDelete === '1';
    const status = row.dataset.status || '';
    const recruiterName = row.dataset.recruiter ? ` (${row.dataset.recruiter})` : '';

    if (!force && !canDelete){
      const confirmForce = window.confirm(
        status
          ? `–°–ª–æ—Ç #${id}${recruiterName} –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å ${status}. –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ?`
          : `–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç #${id}${recruiterName} –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ?`
      );
      if (!confirmForce) return;
      return await performDelete(row, { force: true, skipConfirm: true });
    }

    const confirmationText = force
      ? `–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç #${id}${recruiterName}? –≠—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ.`
      : `–£–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç #${id}${recruiterName}? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`;

    if (!skipConfirm && !window.confirm(confirmationText)) return;

    const rowDeleteBtn = row.querySelector('[data-action="delete-slot"]');
    if (rowDeleteBtn) rowDeleteBtn.disabled = true;
    if (slotDeleteBtn && currentRow === row) slotDeleteBtn.disabled = true;

    try {
      const response = await fetch(`/slots/${id}?force=${force ? 1 : 0}`, {
        method: 'DELETE',
        headers: { 'Accept': 'application/json' },
      });
      const payload = await response.json().catch(() => null);

      if (!response.ok || !payload || payload.ok !== true){
        const message = payload && payload.message ? payload.message : '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç.';
        if (!force && payload && payload.code === 'requires_force'){
          const askForce = window.confirm(`${message} –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ?`);
          if (askForce){
            return await performDelete(row, { force: true, skipConfirm: true });
          }
        }
        toast(message, 'error');
        if (rowDeleteBtn) rowDeleteBtn.disabled = false;
        if (slotDeleteBtn && currentRow === row){
          slotDeleteBtn.disabled = false;
        }
        return;
      }

      toast(payload.message || '–°–ª–æ—Ç —É–¥–∞–ª—ë–Ω', 'success');
      if (currentRow === row){
        closeSheet();
      }
      removeRow(row);
      applyFutureFilter();
      updateRelativeLabels();
    } catch (err){
      console.error(err);
      toast('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç.', 'error');
      if (rowDeleteBtn) rowDeleteBtn.disabled = false;
      if (slotDeleteBtn && currentRow === row){
        slotDeleteBtn.disabled = false;
      }
    }
  }

  function markRowAsFree(row){
    if (!row) return;
    row.dataset.status = 'FREE';
    row.dataset.statusOrder = '0';
    row.dataset.candidate = '';
    row.dataset.candidateId = '';
    row.dataset.candidateTz = '';
    row.dataset.outcome = '';
    row.dataset.canDelete = '1';
    row.dataset.startCand = '';

    const statusCell = row.querySelector('[data-label="–°—Ç–∞—Ç—É—Å"]');
    if (statusCell) statusCell.innerHTML = '<span class="status-badge" data-tone="success">FREE</span>';

    const candidateCell = row.querySelector('[data-label="–ö–∞–Ω–¥–∏–¥–∞—Ç"]');
    if (candidateCell) candidateCell.innerHTML = '<span class="badge badge--soft">‚Äî</span>';

    const candTimeCell = row.querySelector('[data-label="–í—Ä–µ–º—è (–∫–∞–Ω–¥–∏–¥–∞—Ç)"]');
    if (candTimeCell) candTimeCell.innerHTML = '<span class="badge badge--soft">‚Äî</span>';
  }

  async function triggerReschedule(row){
    if (!row) return;
    const slotId = row.dataset.id;
    if (!slotId) return;
    if (slotRescheduleBtn) slotRescheduleBtn.disabled = true;
    if (slotRejectBookingBtn) slotRejectBookingBtn.disabled = true;
    try {
      const response = await fetch(`/slots/${slotId}/reschedule`, {
        method: 'POST',
        headers: { 'Accept': 'application/json' },
      });
      const payload = await response.json().catch(() => null);
      if (!response.ok || !payload || payload.ok !== true){
        const message = payload && payload.message ? payload.message : '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±—Ä–æ–Ω—å.';
        toast(message, 'error');
        return;
      }
      toast(payload.message || '–°–ª–æ—Ç –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω.', 'success');
      markRowAsFree(row);
      hydrateSheet(row);
      updateCounters();
    } catch (err){
      console.error(err);
      toast('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±—Ä–æ–Ω—å.', 'error');
    } finally {
      const candidateValue = (row.dataset.candidate || '').trim();
      const hasCandidate = candidateValue.length > 0;
      if (slotRescheduleBtn) slotRescheduleBtn.disabled = !hasCandidate;
      if (slotRejectBookingBtn) slotRejectBookingBtn.disabled = !hasCandidate;
    }
  }

  async function triggerReject(row){
    if (!row) return;
    const slotId = row.dataset.id;
    if (!slotId) return;
    if (slotRejectBookingBtn) slotRejectBookingBtn.disabled = true;
    if (slotRescheduleBtn) slotRescheduleBtn.disabled = true;
    try {
      const response = await fetch(`/slots/${slotId}/reject_booking`, {
        method: 'POST',
        headers: { 'Accept': 'application/json' },
      });
      const payload = await response.json().catch(() => null);
      if (!response.ok || !payload || payload.ok !== true){
        const message = payload && payload.message ? payload.message : '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–∞–∑.';
        toast(message, 'error');
        return;
      }
      toast(payload.message || '–ö–∞–Ω–¥–∏–¥–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–∫–∞–∑.', 'success');
      markRowAsFree(row);
      hydrateSheet(row);
      updateCounters();
    } catch (err){
      console.error(err);
      toast('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–∞–∑.', 'error');
    } finally {
      const candidateValue = (row.dataset.candidate || '').trim();
      const hasCandidate = candidateValue.length > 0;
      if (slotRescheduleBtn) slotRescheduleBtn.disabled = !hasCandidate;
      if (slotRejectBookingBtn) slotRejectBookingBtn.disabled = !hasCandidate;
    }
  }

  async function deleteAllSlots(force = false){
    const confirmationText = force
      ? '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –¥–∞–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞.'
      : '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏ –æ–∂–∏–¥–∞—é—â–∏–µ —Å–ª–æ—Ç—ã? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.';

    if (!window.confirm(confirmationText)) return;

    if (deleteAllBtn) deleteAllBtn.disabled = true;

    try {
      const response = await fetch('/slots/delete_all', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({ force })
      });
      const payload = await response.json().catch(() => null);

      if (!response.ok || !payload || payload.ok !== true){
        const message = payload && payload.error ? payload.error : '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç—ã.';
        if (!force && payload && typeof payload.remaining === 'number' && payload.remaining > 0){
          const askForce = window.confirm(`${message} –£–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–ª–æ—Ç—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ?`);
          if (askForce){
            return await deleteAllSlots(true);
          }
        }
        toast(message, 'error');
        return;
      }

      const deletedCount = Number(payload.deleted || 0);
      const remaining = Number(payload.remaining || 0);

      if (!force && remaining > 0){
        toast(`–£–¥–∞–ª–µ–Ω–æ ${deletedCount} —Å–ª–æ—Ç(–æ–≤). –û—Å—Ç–∞–ª–æ—Å—å ${remaining}.`, 'info');
        const askForce = window.confirm('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ—Ç—ã –æ—Å—Ç–∞–ª–∏—Å—å. –£–¥–∞–ª–∏—Ç—å –∏—Ö –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ?');
        if (askForce){
          return await deleteAllSlots(true);
        }
        return;
      }

      toast(`–£–¥–∞–ª–µ–Ω–æ ${deletedCount} —Å–ª–æ—Ç(–æ–≤).`, 'success');
      window.location.reload();
    } catch (err){
      console.error(err);
      toast('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç—ã.', 'error');
    } finally {
      if (deleteAllBtn) deleteAllBtn.disabled = false;
    }
  }

  function restorePreferences(){
    if (onlyFuture && storage){
      const saved = storage.getItem(storageKeys.future);
      if (saved !== null) onlyFuture.checked = saved === '1';
    }
    if (candToggle && storage){
      const saved = storage.getItem(storageKeys.candidate);
      if (saved !== null) candToggle.checked = saved === '1';
    }
  }

  function persistPreference(key, value){
    if (!storage) return;
    storage.setItem(key, value ? '1' : '0');
  }

  if (!table || !tbody) return;

  resetSheet();
  restorePreferences();
  setCandidateColumnVisibility(candToggle ? candToggle.checked : false);
  applySort();
  applySortIndicator();
  applyFutureFilter();
  updateRelativeLabels();

  if (relTimer) clearInterval(relTimer);
  relTimer = window.setInterval(updateRelativeLabels, 60000);

  on(tbody, 'click', e => {
    const deleteBtn = e.target.closest('[data-action="delete-slot"]');
    if (deleteBtn){
      e.preventDefault();
      e.stopPropagation();
      const row = deleteBtn.closest('.slot-row');
      performDelete(row);
      return;
    }
    const actionBtn = e.target.closest('[data-action="open-slot"]');
    if (actionBtn){
      const row = actionBtn.closest('.slot-row');
      openSlot(row);
      return;
    }
    const row = e.target.closest('.slot-row');
    if (row) openSlot(row);
  });

  on(tbody, 'dblclick', e => {
    const row = e.target.closest('.slot-row');
    if (row) openSlot(row);
  });

  on(tbody, 'keydown', e => {
    const row = e.target.closest('.slot-row');
    if (!row) return;
    if (e.target.closest('[data-action="delete-slot"]')) return;
    if (e.key === 'Enter'){ e.preventDefault(); openSlot(row); }
    if (e.key === ' '){ e.preventDefault(); openSlot(row); }
  });

  on(table, 'click', e => {
    const sortButton = e.target.closest('.sort');
    if (!sortButton) return;
    const key = sortButton.dataset.key;
    if (!key) return;
    if (sortState.key === key){
      sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
    } else {
      sortState.key = key;
      sortState.dir = 'asc';
    }
    applySort();
    applySortIndicator();
    applyFutureFilter();
  });

  on(onlyFuture, 'change', () => {
    persistPreference(storageKeys.future, !!onlyFuture.checked);
    applyFutureFilter();
  });

  on(candToggle, 'change', () => {
    persistPreference(storageKeys.candidate, !!candToggle.checked);
    setCandidateColumnVisibility(candToggle.checked);
  });

  on(slotOutcomeActions, 'click', e => {
    const btn = e.target.closest('button[data-outcome]');
    if (!btn || btn.disabled) return;
    e.preventDefault();
    submitOutcome(btn.dataset.outcome);
  });

  on(slotRescheduleBtn, 'click', () => {
    if (currentRow) triggerReschedule(currentRow);
  });

  on(slotRejectBookingBtn, 'click', () => {
    if (currentRow) triggerReject(currentRow);
  });

  on(slotDeleteBtn, 'click', () => {
    if (currentRow) performDelete(currentRow);
  });

  on(deleteAllBtn, 'click', () => {
    deleteAllSlots(false);
  });

  on(slotBackdrop, 'click', closeSheet);
  on(slotClose, 'click', closeSheet);
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && !slotSheet.hidden){
      e.preventDefault();
      closeSheet();
    }
    if (e.key === 'f' && onlyFuture){
      onlyFuture.checked = !onlyFuture.checked;
      persistPreference(storageKeys.future, onlyFuture.checked);
      applyFutureFilter();
    }
    if (e.key === 't' && candToggle){
      candToggle.checked = !candToggle.checked;
      persistPreference(storageKeys.candidate, candToggle.checked);
      setCandidateColumnVisibility(candToggle.checked);
    }
  });

})();
</script>

      </div>
    </main>
  </div>
  <script>
    (function () {
      const storageKey = 'tg-admin-theme';
      const docEl = document.documentElement;
      const toggle = document.getElementById('theme-toggle');
      const nav = document.querySelector('[data-topbar-nav]');
      const burger = document.querySelector('[data-topbar-toggle]');
      const scrim = document.querySelector('[data-topbar-scrim]');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

      function storeTheme(theme) {
        try {
          window.localStorage.setItem(storageKey, theme);
        } catch (err) {
          /* noop */
        }
      }

      function getStoredTheme() {
        try {
          return window.localStorage.getItem(storageKey);
        } catch (err) {
          return null;
        }
      }

      function applyTheme(theme, persist = true) {
        const value = theme === 'dark' ? 'dark' : 'light';
        docEl.dataset.theme = value;
        docEl.style.colorScheme = value;
        if (persist) {
          storeTheme(value);
        }
        reflectTheme(value);
      }

      function reflectTheme(theme) {
        if (!toggle) return;
        const isDark = theme === 'dark';
        toggle.setAttribute('aria-pressed', isDark);
        toggle.querySelector('.theme-toggle__icon').textContent = isDark ? 'üåû' : 'üåô';
        toggle.querySelector('.theme-toggle__label').textContent = isDark ? '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞' : '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
        toggle.title = isDark ? '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' : '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç—ë–º–Ω—É—é —Ç–µ–º—É';
      }

      applyTheme(getStoredTheme() || docEl.dataset.theme || (prefersDark.matches ? 'dark' : 'light'), false);

      if (toggle) {
        toggle.addEventListener('click', () => {
          const next = docEl.dataset.theme === 'dark' ? 'light' : 'dark';
          applyTheme(next);
        });
      }

      if (prefersDark && typeof prefersDark.addEventListener === 'function') {
        prefersDark.addEventListener('change', (event) => {
          if (!getStoredTheme()) {
            applyTheme(event.matches ? 'dark' : 'light', false);
          }
        });
      }

      function setNavOpen(open) {
        if (!nav || !burger) return;
        nav.dataset.open = open ? 'true' : 'false';
        burger.setAttribute('aria-expanded', open ? 'true' : 'false');
        if (scrim) {
          scrim.dataset.open = open ? 'true' : 'false';
        }
      }

      if (burger) {
        burger.addEventListener('click', () => {
          const next = nav && nav.dataset.open !== 'true';
          setNavOpen(next);
        });
      }

      if (scrim) {
        scrim.addEventListener('click', () => setNavOpen(false));
      }

      if (nav) {
        nav.addEventListener('click', (event) => {
          const target = event.target;
          if (window.innerWidth <= 768 && target instanceof HTMLElement && target.closest('a')) {
            setNavOpen(false);
          }
        });
      }

      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
          setNavOpen(false);
        }
      });
    })();
  </script>
  
</body>
</html>