{% extends "base.html" %}
{% block title %}Шаблоны сообщений{% endblock %}

{% block content %}
<section class="page page--templates" data-page="templates" aria-labelledby="templates-title">
  <header class="page-header">
    <div>
      <h1 id="templates-title" class="page-title">Шаблоны сообщений</h1>
      <p class="page-description">
        Управляйте текстами, которые бот отправляет кандидатам и рекрутёрам. Активные шаблоны сразу применяются без рестарта.
      </p>
    </div>
    <div class="page-actions">
      <a class="btn btn-primary" href="/message-templates/new">+ Новый шаблон</a>
    </div>
  </header>

  {% if missing_required %}
    <div class="surface glass grain alert" data-tone="danger">
      <p class="page-description">
        Не хватает обязательных шаблонов: {{ missing_required|join(", ") }}. Добавьте их, чтобы бот не использовал дефолтные тексты.
      </p>
    </div>
  {% endif %}

  <div class="list-table-wrapper">
    <table class="list-table list-table--responsive">
      <thead>
        <tr>
          <th scope="col">Ключ</th>
          <th scope="col">Локаль</th>
          <th scope="col">Канал</th>
          <th scope="col">Версия</th>
          <th scope="col">Статус</th>
          <th scope="col" class="is-optional">Подсказка</th>
          <th scope="col" class="col-actions">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% if templates %}
          {% for tpl in templates %}
            <tr>
              <td data-label="Ключ">
                <div class="slot-cell-primary">{{ tpl.key }}</div>
              </td>
              <td data-label="Локаль">
                <span class="badge badge--soft">{{ tpl.locale }}</span>
              </td>
              <td data-label="Канал">
                <span class="badge badge--soft">{{ tpl.channel }}</span>
              </td>
              <td data-label="Версия">
                v{{ tpl.version or 1 }}
              </td>
              <td data-label="Статус">
                {% if tpl.is_active %}
                  <span class="status-badge" data-tone="success">активен</span>
                {% else %}
                  <span class="status-badge" data-tone="warning">выключен</span>
                {% endif %}
              </td>
              <td data-label="Подсказка" class="is-optional">
                {% set hint = known_hints.get(tpl.key) %}
                {% if hint %}
                  <span class="badge badge--soft">{{ hint }}</span>
                {% else %}
                  <span class="badge badge--soft">—</span>
                {% endif %}
              </td>
              <td data-label="Действия" class="col-actions">
                <a class="btn btn-soft btn--small" href="/message-templates/{{ tpl.id }}/edit">Редактировать</a>
                <form method="post" action="/message-templates/{{ tpl.id }}/delete" class="inline-form" onsubmit="return confirmDelete(this);">
                  {{ csrf_input(request) }}
                  <button type="submit" class="btn btn-danger btn--small">Удалить</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="7" class="empty">
              <p class="page-description">Шаблонов пока нет. Создайте первый, чтобы переопределить текст уведомлений.</p>
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>

<script>
  function confirmDelete(form){
    return window.confirm("Удалить шаблон? Вернуть будет нельзя.");
  }
</script>
{% endblock %}
