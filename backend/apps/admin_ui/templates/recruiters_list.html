{% extends "base.html" %}
{% block title %}Рекрутёры{% endblock %}
{% block content %}
<section class="page">
  <header class="page-header">
    <div>
      <h1 class="page-title">Рекрутёры</h1>
      <p class="page-description">
        Следите за нагрузкой, ближайшими слотами и ответственными городами каждого рекрутёра.
      </p>
    </div>
    <div class="page-actions">
      <a class="btn btn--primary" href="/recruiters/new">Добавить рекрутёра</a>
    </div>
  </header>

  {% if not recruiter_rows %}
    <div class="card glass grain">
      <h3 class="section-title">Пока пусто</h3>
      <p class="page-description">Записи отсутствуют. Создайте первого рекрутёра, чтобы начать работу.</p>
      <div class="page-actions">
        <a class="btn btn--primary" href="/recruiters/new">Добавить рекрутёра</a>
      </div>
    </div>
  {% else %}
    <div id="recs_grid" class="card-grid">
      {% for item in recruiter_rows %}
        {% set r = item.rec %}
        {% set stats = item.stats %}
        {% set active = r.active if r.active is not none else False %}
        <article class="recruiter-card">
          <header class="recruiter-card__header">
            <div class="recruiter-card__identity">
              <h2 class="recruiter-card__name">{{ r.name }}</h2>
              <div class="meta-list">
                <span>#{{ r.id }}</span>
                <span title="Часовой пояс">{{ r.tz or 'Europe/Moscow' }}</span>
                {% if r.tg_chat_id %}
                  <span title="ID чата в Telegram">chat_id {{ r.tg_chat_id }}</span>
                {% endif %}
              </div>
            </div>
            <span class="status-pill" data-state="{{ 'on' if active else 'off' }}">
              {{ 'Активен' if active else 'Отключен' }}
            </span>
          </header>

          <div class="recruiter-card__body">
            <div class="recruiter-card__section">
              <h3 class="section-title">Нагрузка</h3>
              <dl class="recruiter-metrics">
                <div>
                  <dt>Свободно</dt>
                  <dd>{{ stats.free }}</dd>
                </div>
                <div>
                  <dt>Ожидают</dt>
                  <dd>{{ stats.pending }}</dd>
                </div>
                <div>
                  <dt>Занято</dt>
                  <dd>{{ stats.booked }}</dd>
                </div>
                <div>
                  <dt>Всего</dt>
                  <dd>{{ stats.total }}</dd>
                </div>
              </dl>
            </div>

            <div class="recruiter-card__section">
              <h3 class="section-title">Города</h3>
              <div class="badge-row">
                {% if item.cities %}
                  {% for cname, ctz in item.cities %}
                    <span class="badge" title="{{ ctz }}">{{ cname }}</span>
                  {% endfor %}
                {% else %}
                  <span class="muted">не назначены</span>
                {% endif %}
              </div>
            </div>

            <div class="recruiter-card__section">
              <h3 class="section-title">Ближайший свободный слот</h3>
              {% if item.next_free_local %}
                <span class="badge">
                  {{ item.next_free_local }}{% if not item.next_is_future %} · истёк{% endif %}
                </span>
              {% else %}
                <span class="muted">Нет свободных слотов</span>
              {% endif %}
            </div>
          </div>

          <footer class="recruiter-card__footer">
            <a class="btn btn--soft btn--grow" href="/recruiters/{{ r.id }}/edit">Редактировать</a>
            <form class="inline-form" method="post" action="/recruiters/{{ r.id }}/delete" onsubmit="return confirm('Удалить рекрутёра {{ r.name }}?');">
              <button class="btn btn--danger btn--grow" type="submit">Удалить</button>
            </form>
          </footer>
        </article>
      {% endfor %}
    </div>
  {% endif %}
</section>
{% endblock %}
