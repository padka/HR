{% extends "base.html" %}
{% import "partials/form_shell.html" as forms %}
{% block title %}Редактирование вопроса{% endblock %}
{% block content %}
{% call forms.shell(
  title="Редактирование вопроса",
  description="Измените параметры и текст вопроса.",
  form_id="question-form",
  action='/questions/' ~ detail.question.id ~ '/update',
  autocomplete="off",
  back_href="/questions",
  back_label="К списку вопросов",
  meta=['ID #' ~ detail.question.id, 'Тест ' ~ detail.question.test_id],
  actions=[
    {"type": "submit", "text": "Сохранить изменения", "variant": "primary"},
    {"href": "/questions", "text": "Отмена", "variant": "ghost"}
  ]
) %}
  {% if error_message %}
    <div class="alert alert--danger">{{ error_message }}</div>
  {% endif %}

  {% call forms.section("Общие параметры") %}
    <div class="form-grid form-grid--three">
      {% call forms.field("Тест") %}
        <select name="test_id" required>
          {% for key, label in detail.test_choices %}
            <option value="{{ key }}" {% if key == detail.question.test_id %}selected{% endif %}>{{ label }} ({{ key }})</option>
          {% endfor %}
        </select>
      {% endcall %}
      {% call forms.field("Порядковый номер") %}
        <input type="number" name="question_index" min="1" value="{{ detail.question.question_index }}" required>
      {% endcall %}
      {% call forms.field("Статус") %}
        {{ forms.switch(name='is_active', value='1', checked=detail.question.is_active, label='Вопрос активен') }}
      {% endcall %}
    </div>

    {% call forms.field("Заголовок для списка") %}
      <input type="text" name="title" value="{{ detail.question.title }}" placeholder="Например: Ознакомительный день" autocomplete="off">
    {% endcall %}
  {% endcall %}

  {% call forms.section("Данные вопроса") %}
    {% call forms.field("JSON", hint="Структура должна соответствовать формату, который использует бот.") %}
      <textarea name="payload" rows="16" class="text-mono" required>{{ detail.payload_json }}</textarea>
      {% call forms.note() %}Для вопросов с вариантами ответов укажите поля <code>options</code> и <code>correct</code>.{% endcall %}
    {% endcall %}
  {% endcall %}
{% endcall %}
{% endblock %}
