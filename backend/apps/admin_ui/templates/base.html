<!doctype html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}–ê–¥–º–∏–Ω–∫–∞{% endblock %} ¬∑ TG Bot Admin</title>
  <link rel="icon" href="/static/favicon.ico">
  <link rel="stylesheet" href="/static/css/theme.css">
  <link rel="stylesheet" href="/static/css/lists.css">
  <link rel="stylesheet" href="/static/css/dashboard.css">
  <script>
    (function () {
      var storageKey = "tg-admin-theme";
      try {
        var stored = window.localStorage.getItem(storageKey);
        var prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        var theme = stored || (prefersDark ? "dark" : "light");
        document.documentElement.dataset.theme = theme;
        document.documentElement.style.colorScheme = theme;
      } catch (err) {
        document.documentElement.dataset.theme = document.documentElement.dataset.theme || "dark";
        document.documentElement.style.colorScheme = document.documentElement.dataset.theme;
      }
    })();
  </script>
  </head>
<body>
  <div aria-hidden="true" class="halo"></div>
  <header>
    <nav class="nav glass grain" role="navigation">
      <div class="nav__section nav__section--primary">
        <a class="brand" href="/">TG Bot Admin</a>
        <a href="/" class="{% if request.url.path == '/' %}active{% endif %}">–î–∞—à–±–æ—Ä–¥</a>
        <a href="/recruiters" class="{% if request.url.path.startswith('/recruiters') %}active{% endif %}">–†–µ–∫—Ä—É—Ç—ë—Ä—ã</a>
        <a href="/cities" class="{% if request.url.path.startswith('/cities') %}active{% endif %}">–ì–æ—Ä–æ–¥–∞</a>
        <a href="/slots" class="{% if request.url.path.startswith('/slots') %}active{% endif %}">–°–ª–æ—Ç—ã</a>
        <a href="/templates" class="{% if request.url.path.startswith('/templates') %}active{% endif %}">–®–∞–±–ª–æ–Ω—ã</a>
        <a href="/questions" class="{% if request.url.path.startswith('/questions') %}active{% endif %}">–í–æ–ø—Ä–æ—Å—ã</a>
      </div>
      <div class="nav__section nav__meta">
        <button id="theme-toggle" class="btn theme-toggle" type="button" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" aria-pressed="true">
          <span class="theme-toggle__icon" aria-hidden="true">üåô</span>
          <span class="theme-toggle__label">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
        </button>
        <span class="badge nav__env">{{ request.url.hostname or 'localhost' }}</span>
      </div>
    </nav>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>
<script type="module" src="/static/js/modules/effects.js"></script>
<script>
  (function(){
    const docEl = document.documentElement;
    const storageKey = 'tg-admin-theme';
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const toggle = document.getElementById('theme-toggle');

    function getStoredTheme() {
      try { return window.localStorage.getItem(storageKey); } catch (err) { return null; }
    }

    function storeTheme(theme) {
      try { window.localStorage.setItem(storageKey, theme); } catch (err) { /* noop */ }
    }

    function applyTheme(theme, persist = true) {
      const next = theme === 'light' ? 'light' : 'dark';
      docEl.dataset.theme = next;
      docEl.style.colorScheme = next;
      if (persist) {
        storeTheme(next);
      }
      reflectTheme(next);
    }

    function reflectTheme(theme) {
      if (!toggle) { return; }
      toggle.dataset.mode = theme;
      toggle.setAttribute('aria-pressed', theme === 'dark');
      const icon = theme === 'dark' ? 'üåô' : 'üåû';
      const label = theme === 'dark' ? '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
      toggle.querySelector('.theme-toggle__icon').textContent = icon;
      toggle.querySelector('.theme-toggle__label').textContent = label;
      toggle.title = '–°–º–µ–Ω–∏—Ç—å –Ω–∞ ' + (theme === 'dark' ? '—Å–≤–µ—Ç–ª—É—é' : '—Ç—ë–º–Ω—É—é') + ' —Ç–µ–º—É';
    }

    const stored = getStoredTheme();
    const initialTheme = stored || docEl.dataset.theme || (prefersDark.matches ? 'dark' : 'light');
    applyTheme(initialTheme, false);

    if (toggle) {
      toggle.addEventListener('click', () => {
        const current = docEl.dataset.theme === 'light' ? 'light' : 'dark';
        const next = current === 'dark' ? 'light' : 'dark';
        applyTheme(next);
      });
    }

    if (prefersDark && typeof prefersDark.addEventListener === 'function') {
      prefersDark.addEventListener('change', event => {
        if (!getStoredTheme()) {
          applyTheme(event.matches ? 'dark' : 'light', false);
        }
      });
    }
  })();
</script>
</body>
</html>
