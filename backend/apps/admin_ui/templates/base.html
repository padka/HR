<!doctype html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}–ê–¥–º–∏–Ω–∫–∞{% endblock %} ¬∑ TG Bot Admin</title>
  <link rel="icon" href="/static/favicon.ico">
  <link rel="stylesheet" href="/static/css/admin.css">
  <script>
    (function () {
      var storageKey = 'tg-admin-theme';
      try {
        var stored = window.localStorage.getItem(storageKey);
        var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.dataset.theme = theme;
        document.documentElement.style.colorScheme = theme;
      } catch (err) {
        document.documentElement.dataset.theme = document.documentElement.dataset.theme || 'dark';
        document.documentElement.style.colorScheme = document.documentElement.dataset.theme;
      }
    })();
  </script>
</head>
<body>
  <div aria-hidden="true" class="app-backdrop"></div>
  <div aria-hidden="true" class="app-backdrop app-backdrop--layer"></div>
  <header class="app-header">
    <div class="app-header__inner glass">
      <a class="brand" href="/">TG Bot Admin</a>
      <nav class="app-nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
        <a href="/" class="app-nav__link {% if request.url.path == '/' %}app-nav__link--active{% endif %}">–î–∞—à–±–æ—Ä–¥</a>
        <a href="/recruiters" class="app-nav__link {% if request.url.path.startswith('/recruiters') %}app-nav__link--active{% endif %}">–†–µ–∫—Ä—É—Ç—ë—Ä—ã</a>
        <a href="/cities" class="app-nav__link {% if request.url.path.startswith('/cities') %}app-nav__link--active{% endif %}">–ì–æ—Ä–æ–¥–∞</a>
        <a href="/slots" class="app-nav__link {% if request.url.path.startswith('/slots') %}app-nav__link--active{% endif %}">–°–ª–æ—Ç—ã</a>
        <a href="/templates" class="app-nav__link {% if request.url.path.startswith('/templates') %}app-nav__link--active{% endif %}">–®–∞–±–ª–æ–Ω—ã</a>
        <a href="/questions" class="app-nav__link {% if request.url.path.startswith('/questions') %}app-nav__link--active{% endif %}">–í–æ–ø—Ä–æ—Å—ã</a>
      </nav>
      <div class="app-header__meta">
        <button id="theme-toggle" class="theme-toggle" type="button" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" data-theme-toggle aria-pressed="true">
          <span class="theme-toggle__icon" data-icon aria-hidden="true">üåô</span>
          <span class="theme-toggle__label" data-label>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
        </button>
        <span class="badge badge--subtle">{{ request.url.hostname or 'localhost' }}</span>
      </div>
    </div>
  </header>

  <main class="app-main">
    <div class="page">
      {% block content %}{% endblock %}
    </div>
  </main>

  <script>
    (function () {
      const storageKey = 'tg-admin-theme';
      const docEl = document.documentElement;
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
      const toggle = document.querySelector('[data-theme-toggle]');

      const getStoredTheme = () => {
        try {
          return window.localStorage.getItem(storageKey);
        } catch (err) {
          return null;
        }
      };

      const storeTheme = (theme) => {
        try {
          window.localStorage.setItem(storageKey, theme);
        } catch (err) {
          /* noop */
        }
      };

      const reflectTheme = (theme) => {
        if (!toggle) {
          return;
        }
        toggle.dataset.mode = theme;
        toggle.setAttribute('aria-pressed', theme === 'dark');
        const icon = theme === 'dark' ? 'üåô' : 'üåû';
        const label = theme === 'dark' ? '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
        const iconNode = toggle.querySelector('[data-icon]');
        const labelNode = toggle.querySelector('[data-label]');
        if (iconNode) {
          iconNode.textContent = icon;
        }
        if (labelNode) {
          labelNode.textContent = label;
        }
        toggle.title = theme === 'dark' ? '–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' : '–í–∫–ª—é—á–∏—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É';
      };

      const applyTheme = (theme, persist = true) => {
        const next = theme === 'light' ? 'light' : 'dark';
        docEl.dataset.theme = next;
        docEl.style.colorScheme = next;
        if (persist) {
          storeTheme(next);
        }
        reflectTheme(next);
      };

      const stored = getStoredTheme();
      const initialTheme = stored || docEl.dataset.theme || (prefersDark.matches ? 'dark' : 'light');
      applyTheme(initialTheme, false);

      if (toggle) {
        toggle.addEventListener('click', () => {
          const current = docEl.dataset.theme === 'dark' ? 'dark' : 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          applyTheme(next);
        });
      }

      if (prefersDark && typeof prefersDark.addEventListener === 'function') {
        prefersDark.addEventListener('change', (event) => {
          if (!getStoredTheme()) {
            applyTheme(event.matches ? 'dark' : 'light', false);
          }
        });
      }
    })();
  </script>
</body>
</html>
