{% extends "base.html" %}
{% import "partials/form_shell.html" as forms %}
{% block title %}Редактирование рекрутёра{% endblock %}
{% block content %}
{% set form_values = form_data %}
{% call forms.shell(
  title=recruiter.name,
  description="Измените данные и закреплённые города.",
  form_id="recruiter-edit",
  action='/recruiters/' ~ recruiter.id ~ '/update',
  autocomplete="off",
  back_href="/recruiters",
  back_label="К списку рекрутёров",
  meta=['ID #' ~ recruiter.id],
  actions=[
    {"type": "submit", "text": "Сохранить", "variant": "primary"},
    {"href": "/recruiters", "text": "Отмена", "variant": "ghost"}
  ]
) %}
  {% if form_errors %}
    <p class="form-note" role="alert">
      <strong>Проверьте форму:</strong><br>
      {% for err in form_errors %}
        {{ err }}{% if not loop.last %}<br>{% endif %}
      {% endfor %}
    </p>
  {% endif %}
  {% call forms.section("Основные данные") %}
    <div class="form-grid form-grid--two">
      {% call forms.field("Имя") %}
        <input type="text" name="name" value="{{ form_values.name or recruiter.name }}" required>
      {% endcall %}
      {% call forms.field("Часовой пояс", hint="IANA TZ, например Europe/Moscow") %}
        <input type="text" name="tz" value="{{ form_values.tz or recruiter.tz or 'Europe/Moscow' }}" list="tz-list" required>
        <datalist id="tz-list">
          <option value="Europe/Moscow">
          <option value="Europe/Samara">
          <option value="Europe/Kaliningrad">
          <option value="Asia/Yekaterinburg">
          <option value="Asia/Novosibirsk">
          <option value="Asia/Krasnoyarsk">
          <option value="Asia/Irkutsk">
          <option value="Asia/Vladivostok">
          <option value="Asia/Almaty">
        </datalist>
      {% endcall %}
    </div>
    <div class="form-grid form-grid--two">
      {% call forms.field("Ссылка на Телемост", hint="Например: https://telemost.yandex.ru/j/XXXXX") %}
        <input type="url" name="telemost" value="{{ form_values.telemost if form_values.telemost is not none else recruiter.telemost_url or '' }}">
      {% endcall %}
      {% call forms.field("Telegram chat_id", hint="Можно оставить пустым, если чат ещё не связан") %}
        <input type="number" name="tg_chat_id" value="{{ form_values.tg_chat_id if form_values.tg_chat_id is not none else recruiter.tg_chat_id or '' }}" min="1" step="1">
      {% endcall %}
    </div>
  {% endcall %}

  {% call forms.section("Ответственные города", hint="Выберите несколько — бот будет назначать им заявки") %}
    <div class="choice-grid" role="group" aria-label="Ответственные города">
      {% for city in cities %}
        <label class="choice-tile">
          <input type="checkbox" name="cities" value="{{ city.id }}" {% if city.id in form_values.city_ids %}checked{% endif %}>
          <span class="choice-tile__title">{{ city.name }}</span>
          <span class="choice-tile__meta">{{ city.tz }}</span>
        </label>
      {% endfor %}
    </div>
  {% endcall %}

  {% call forms.field("Статус") %}
    {{ forms.switch(name='active', value='1', checked=form_values.active, label='Активен') }}
  {% endcall %}
{% endcall %}
{% endblock %}
