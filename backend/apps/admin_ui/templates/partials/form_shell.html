{% macro shell(title, description='', form_id='', action='', method='post', autocomplete='off', enctype='', back_href='', back_label='Назад', meta=(), actions=(), form_class='', section_id='', hidden=False) -%}
<section class="form-shell"{% if section_id %} id="{{ section_id }}"{% endif %}{% if hidden %} hidden{% endif %}>
  <header class="form-shell__header">
    {% if back_href %}
      <div class="form-shell__breadcrumbs">
        <a href="{{ back_href }}" class="muted">← {{ back_label }}</a>
      </div>
    {% endif %}
    <div class="form-shell__heading">
      <h1 class="form-shell__title">{{ title }}</h1>
      {% if description %}<p class="form-shell__description">{{ description }}</p>{% endif %}
    </div>
    {% if meta %}
      <div class="form-shell__meta">
        {% for item in meta %}
          <span class="badge">{{ item }}</span>
        {% endfor %}
      </div>
    {% endif %}
  </header>
  <form class="form-shell__form {{ form_class }}"{% if form_id %} id="{{ form_id }}"{% endif %}{% if action %} action="{{ action }}"{% endif %}{% if method %} method="{{ method }}"{% endif %}{% if autocomplete %} autocomplete="{{ autocomplete }}"{% endif %}{% if enctype %} enctype="{{ enctype }}"{% endif %}>
    {% if method and method|lower == 'post' %}
      {{ csrf_input(request) }}
    {% endif %}
    <div class="form-shell__body">
      {{ caller() }}
    </div>
    {% if actions %}
      <footer class="form-shell__footer">
        <div class="form-shell__actions">
          {% for btn in actions %}
            {% set variant = 'btn--' + (btn.variant or 'primary') %}
            {% if btn.href %}
              <a href="{{ btn.href }}" class="btn {{ variant }}{% if btn.block %} btn--block{% endif %}">{{ btn.text }}</a>
            {% else %}
              <button type="{{ btn.type or 'button' }}" class="btn {{ variant }}{% if btn.block %} btn--block{% endif %}"{% if btn.id %} id="{{ btn.id }}"{% endif %}{% if btn.name %} name="{{ btn.name }}"{% endif %}{% if btn.value is not none %} value="{{ btn.value }}"{% endif %}{% if btn.disabled %} disabled{% endif %}>{{ btn.text }}</button>
            {% endif %}
          {% endfor %}
        </div>
      </footer>
    {% endif %}
  </form>
</section>
{%- endmacro %}

{% macro section(title, hint='', span='auto') -%}
<section class="form-shell__section{% if span == 'full' %} form-shell__section--full{% endif %}">
  <div class="form-shell__section-header">
    <h2 class="form-shell__section-title">{{ title }}</h2>
    {% if hint %}<p class="form-shell__section-hint">{{ hint }}</p>{% endif %}
  </div>
  <div class="form-shell__section-content">
    {{ caller() }}
  </div>
</section>
{%- endmacro %}

{% macro field(label='', hint='', inline=False) -%}
<label class="form-field{% if inline %} form-field--inline{% endif %}">
  {% if label %}<span class="form-field__label">{{ label }}</span>{% endif %}
  <div class="form-field__surface">
    {{ caller() }}
  </div>
  {% if hint %}<span class="form-field__hint">{{ hint }}</span>{% endif %}
</label>
{%- endmacro %}

{% macro meta(attrs='') -%}
<div class="form-meta"{% if attrs %} {{ attrs|safe }}{% endif %}>
  {{ caller() }}
</div>
{%- endmacro %}

{% macro note(inline=False, id='') -%}
<p class="form-note{% if inline %} form-note--inline{% endif %}"{% if id %} id="{{ id }}"{% endif %}>
  {{ caller() }}
</p>
{%- endmacro %}

{% macro switch(id='', name='', value='1', label='', hint='', checked=False, disabled=False, inline=False) -%}
<label class="form-switch{% if inline %} form-switch--inline{% endif %}">
  <input type="checkbox" value="{{ value }}"{% if id %} id="{{ id }}"{% endif %}{% if name %} name="{{ name }}"{% endif %}{% if checked %} checked{% endif %}{% if disabled %} disabled{% endif %}>
  <span class="form-switch__track" aria-hidden="true">
    <span class="form-switch__thumb"></span>
  </span>
  {% if caller is defined or label %}
    <span class="form-switch__label">{{ caller() if caller is defined else label }}</span>
  {% endif %}
  {% if hint %}<span class="form-switch__hint">{{ hint }}</span>{% endif %}
</label>
{%- endmacro %}
