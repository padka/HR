{% macro page_header(title, eyebrow=None, description=None, meta=None, badges=None) -%}
  <header class="page-header">
    <div class="page-header__text">
      {% if eyebrow %}<p class="page-header__eyebrow muted">{{ eyebrow }}</p>{% endif %}
      <h1 class="page-header__title">{{ title }}</h1>
      {% if description %}<p class="page-header__description muted">{{ description }}</p>{% endif %}
      {% if meta %}<p class="page-header__meta muted">{{ meta }}</p>{% endif %}
      {% if badges %}
        <ul class="page-header__badges" role="list">
          {% for item in badges %}
            <li>
              <span class="badge badge-{{ item.tone | default('muted') }}">
                <span class="badge__dot" aria-hidden="true"></span>
                {{ item.label }}
              </span>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
    {% if caller is defined %}
      <div class="page-header__actions">
        {{ caller() }}
      </div>
    {% endif %}
  </header>
{%- endmacro %}

{% macro kpi_section(section_id, eyebrow=None, title=None, meta=None, cards=None, empty_text=None, placeholder_text=None, is_placeholder=False, default_hint=None) -%}
  <section class="kpi-section panel" aria-labelledby="{{ section_id }}">
    <header class="kpi-section__header">
      <div class="kpi-section__heading">
        {% if eyebrow %}<p class="kpi-section__eyebrow">{{ eyebrow }}</p>{% endif %}
        {% if title %}<h2 id="{{ section_id }}" class="kpi-section__title">{{ title }}</h2>{% endif %}
        {% if meta %}<p class="kpi-section__meta">{{ meta }}</p>{% endif %}
      </div>
      {% if caller is defined %}
        <div class="kpi-section__actions">
          {{ caller() }}
        </div>
      {% endif %}
    </header>
    <div class="kpi-section__grid">
      {% if is_placeholder and placeholder_text %}
        <p class="kpi-section__placeholder muted">{{ placeholder_text }}</p>
      {% elif cards %}
        {% for card in cards %}
          {% set trend = card.trend %}
          <button
            type="button"
            class="kpi-card surface focus-ring tone-{{ card.tone }}"
            data-metric="{{ card.key }}"
            aria-haspopup="dialog"
            aria-controls="kpi_drawer"
            aria-label="{{ card.label }}: {{ card.value }}. {{ trend.label if trend else '' }}"
          >
            <span class="kpi-card__body">
              <span class="kpi-card__label">{{ card.label }}</span>
              <span class="kpi-card__value"{% if card.value_id %} id="{{ card.value_id }}"{% endif %}>{{ card.value }}</span>
              {% set hint = card.hint if card.hint is not none else default_hint %}
              {% if hint %}<span class="kpi-card__hint">{{ hint }}</span>{% endif %}
            </span>
            <span class="kpi-card__aside">
              {% if trend %}<span class="kpi-card__trend trend--{{ trend.direction }}" aria-label="{{ trend.label }}">{{ trend.display }}</span>{% endif %}
              {% if card.icon %}<span class="kpi-card__icon" aria-hidden="true">{{ card.icon }}</span>{% endif %}
            </span>
          </button>
        {% endfor %}
      {% elif empty_text %}
        <p class="kpi-section__empty muted">{{ empty_text }}</p>
      {% endif %}
    </div>
  </section>
{%- endmacro %}

{% macro stat_cards(items=None, class_name=None) -%}
  <section class="stat-grid{% if class_name %} {{ class_name }}{% endif %}">
    {% if items is not none %}
      {% for card in items %}
        <article class="stat-card surface">
          <span class="stat-card__label">{{ card.label }}</span>
          <span class="stat-card__value">{{ card.value }}</span>
          {% if card.meta %}<span class="stat-card__meta">{{ card.meta }}</span>{% endif %}
        </article>
      {% endfor %}
    {% elif caller is defined %}
      {{ caller() }}
    {% endif %}
  </section>
{%- endmacro %}

{% macro filter_bar(title=None, hint=None, class_name=None) -%}
  <section class="filter-bar panel{% if class_name %} {{ class_name }}{% endif %}">
    {% if title or hint %}
      <header class="filter-bar__header">
        {% if title %}<h2 class="filter-bar__title">{{ title }}</h2>{% endif %}
        {% if hint %}<p class="filter-bar__hint muted">{{ hint }}</p>{% endif %}
      </header>
    {% endif %}
    <div class="filter-bar__controls">
      {% if caller is defined %}
        {{ caller() }}
      {% endif %}
    </div>
  </section>
{%- endmacro %}

{% macro data_table(columns=None, caption=None, sticky_header=True, table_class=None, table_id=None, body_id=None) -%}
  <div class="table-shell">
    <table{% if table_id %} id="{{ table_id }}"{% endif %} class="data-table{% if sticky_header %} data-table--sticky{% endif %}{% if table_class %} {{ table_class }}{% endif %}">
      {% if caption %}<caption class="visually-hidden">{{ caption }}</caption>{% endif %}
      {% if columns %}
        <thead>
          <tr>
            {% for column in columns %}
              {% if column is mapping %}
                <th scope="col"{% if column.class %} class="{{ column.class }}"{% endif %}>
                  {{ column.html | default(column.label) | safe }}
                </th>
              {% else %}
                <th scope="col">{{ column }}</th>
              {% endif %}
            {% endfor %}
          </tr>
        </thead>
      {% endif %}
      <tbody{% if body_id %} id="{{ body_id }}"{% endif %}>
        {% if caller is defined %}
          {{ caller() }}
        {% endif %}
      </tbody>
    </table>
  </div>
{%- endmacro %}
