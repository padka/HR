{% extends "base_liquid.html" %}
{% import "partials/form_shell.html" as forms %}
{% block title %}Новый рекрутёр{% endblock %}
{% block content %}
{% set form_state = form_data or {} %}
{% set selected_cities = form_state.get('cities', []) %}
{% if form_error %}
  <div class="surface glass grain alert" data-tone="danger" role="alert">
    {{ form_error }}
  </div>
{% endif %}
{% call forms.shell(
  title="Новый рекрутёр",
  description="Создайте запись, чтобы бот мог назначать встречи.",
  form_id="recForm",
  action="/recruiters/create",
  autocomplete="off",
  actions=[
    {"type": "submit", "text": "Сохранить", "variant": "primary"},
    {"href": "/recruiters", "text": "Отмена", "variant": "ghost"}
  ]
) %}
  {% call forms.section("Основные данные") %}
    <div class="form-grid form-grid--two">
      {% call forms.field("Имя") %}
        <input id="name" type="text" name="name" value="{{ form_state.get('name', '') }}" placeholder="Михаил" required>
      {% endcall %}
      {% call forms.field("Регион", hint="Определяет локальное время рекрутёра при создании слотов") %}
        {% set current_tz = form_state.get('tz', 'Europe/Moscow') %}
        <select id="tz" name="tz" required>
          {% for option in tz_options %}
            <option value="{{ option.value }}" {% if option.value == current_tz %}selected{% endif %}>
              {{ option.label }}
            </option>
          {% endfor %}
        </select>
      {% endcall %}
    </div>
    <div class="form-grid form-grid--two">
      {% call forms.field("Ссылка на Телемост", hint="Например: https://telemost.yandex.ru/j/XXXXX") %}
        <input id="telemost" type="url" name="telemost" value="{{ form_state.get('telemost', '') }}">
      {% endcall %}
      {% call forms.field("Telegram chat_id", hint="Можно оставить пустым, если чат ещё не связан") %}
        <input id="tg_chat_id" type="number" name="tg_chat_id" value="{{ form_state.get('tg_chat_id', '') }}" min="1" step="1" placeholder="7588303412">
      {% endcall %}
    </div>
  {% endcall %}

  {% call forms.section("Ответственные города", hint="Выберите несколько — бот будет назначать им заявки") %}
    <div class="choice-grid" role="group" aria-label="Ответственные города">
      {% for city in cities %}
        <label class="choice-tile">
          {% set checked = city.id in selected_cities %}
          <input type="checkbox" name="cities" value="{{ city.id }}" {% if checked %}checked{% endif %}>
          <span class="choice-tile__title">{{ city.name }}</span>
          <span class="choice-tile__meta">{{ city.tz }}</span>
        </label>
      {% endfor %}
    </div>
  {% endcall %}

  {% call forms.field("Статус") %}
    {{ forms.switch(id='active', name='active', value='1', checked=form_state.get('active', True), label='Активен') }}
  {% endcall %}
{% endcall %}
{% endblock %}
