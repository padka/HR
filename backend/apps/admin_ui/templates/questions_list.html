{% extends "base.html" %}

{% block title %}Вопросы{% endblock %}

{% block content %}
<section class="glass" style="padding:24px; margin-bottom:20px;">
  <h1 style="margin-top:0;">База вопросов</h1>
  <p class="muted" style="max-width:720px;">
    Здесь собраны вопросы для всех тестов. Вы можете открыть вопрос и изменить его текст,
    варианты ответов или структуру JSON. Изменения вступят в силу после сохранения.
  </p>
</section>

{% if tests %}
  {% for test in tests %}
    <section class="glass" style="padding:18px; margin-bottom:20px;">
      <header style="display:flex; align-items:center; gap:12px; margin-bottom:14px;">
        <h2 style="margin:0; font-size:20px;">{{ test.title }}</h2>
        <span class="badge">{{ test.test_id }}</span>
        <span class="muted" style="margin-left:auto;">{{ test.questions|length }} вопросов</span>
      </header>
      <div style="overflow-x:auto;">
        <table>
          <thead>
            <tr>
              <th style="width:80px;">№</th>
              <th>Вопрос</th>
              <th style="width:140px;">Тип</th>
              <th style="width:160px;">Последнее изменение</th>
              <th style="width:120px;">Статус</th>
              <th style="width:120px; text-align:right;">Действия</th>
            </tr>
          </thead>
          <tbody>
          {% for item in test.questions %}
            <tr>
              <td>{{ item.index }}</td>
              <td>
                <div style="font-weight:600;">{{ item.title }}</div>
                <div class="muted" style="font-size:12px;">{{ item.prompt }}</div>
                {% if item.options_count %}
                  <div class="muted" style="font-size:12px; margin-top:4px;">
                    Вариантов: {{ item.options_count }}{% if item.correct_label %}, верный: {{ item.correct_label }}{% endif %}
                  </div>
                {% endif %}
              </td>
              <td>
                {% if item.kind == 'choice' %}
                  <span class="badge" style="display:inline-block;">Варианты</span>
                {% else %}
                  <span class="badge" style="display:inline-block;">Свободный ответ</span>
                {% endif %}
              </td>
              <td>{% if item.updated_at %}{{ fmt_utc(item.updated_at) }} UTC{% else %}—{% endif %}</td>
              <td>
                {% if item.is_active %}
                  <span class="badge" style="color:var(--ok); border-color:rgba(35,209,139,.35);">Активен</span>
                {% else %}
                  <span class="badge" style="color:var(--muted);">Скрыт</span>
                {% endif %}
              </td>
              <td style="text-align:right;">
                <a class="btn" href="/questions/{{ item.id }}/edit">Редактировать</a>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" style="text-align:center; padding:20px;" class="muted">Пока нет вопросов.</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  {% endfor %}
{% else %}
  <section class="glass" style="padding:24px;">
    <p class="muted" style="margin:0;">Вопросы ещё не добавлены.</p>
  </section>
{% endif %}
{% endblock %}
