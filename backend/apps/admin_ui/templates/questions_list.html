{% extends "base.html" %}

{% block title %}Вопросы{% endblock %}

{% block content %}
<section class="page">
  <header class="page-header">
    <div>
      <h1 class="page-title">База вопросов</h1>
      <p class="page-description">
        Здесь собраны вопросы для всех тестов. Вы можете открыть вопрос и изменить его текст, варианты ответов или структуру JSON.
      </p>
    </div>
  </header>

  {% if tests %}
    {% for test in tests %}
      <section class="test-section" data-tilt>
        <header class="test-section__header">
          <h2 class="card-title">{{ test.title }}</h2>
          <span class="badge">{{ test.test_id }}</span>
          <span class="test-section__meta">{{ test.questions|length }} вопросов</span>
        </header>
        <div class="list-table-wrapper">
          <table class="list-table list-table--responsive">
            <thead>
              <tr>
                <th>№</th>
                <th>Вопрос</th>
                <th>Тип</th>
                <th>Последнее изменение</th>
                <th>Статус</th>
                <th class="cell-actions">Действия</th>
              </tr>
            </thead>
            <tbody>
            {% for item in test.questions %}
              <tr>
                <td data-label="№">{{ item.index }}</td>
                <td data-label="Вопрос">
                  <div class="question-title">{{ item.title }}</div>
                  <div class="question-meta">{{ item.prompt }}</div>
                  {% if item.options_count %}
                    <div class="question-meta--small">
                      Вариантов: {{ item.options_count }}{% if item.correct_label %}, верный: {{ item.correct_label }}{% endif %}
                    </div>
                  {% endif %}
                </td>
                <td data-label="Тип">
                  {% if item.kind == 'choice' %}
                    <span class="badge">Варианты</span>
                  {% else %}
                    <span class="badge">Свободный ответ</span>
                  {% endif %}
                </td>
                <td data-label="Последнее изменение">{% if item.updated_at %}{{ fmt_utc(item.updated_at) }} UTC{% else %}—{% endif %}</td>
                <td data-label="Статус">
                  {% if item.is_active %}
                    <span class="status-badge" data-tone="success">Активен</span>
                  {% else %}
                    <span class="status-badge" data-tone="danger">Скрыт</span>
                  {% endif %}
                </td>
                <td class="cell-actions" data-label="">
                  <a class="btn btn-soft" href="/questions/{{ item.id }}/edit">Редактировать</a>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="6" data-label="">
                  <div class="muted table-empty">Пока нет вопросов.</div>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    {% endfor %}
  {% else %}
    <section class="test-section">
      <p class="page-description">Вопросы ещё не добавлены.</p>
    </section>
  {% endif %}
</section>
{% endblock %}
