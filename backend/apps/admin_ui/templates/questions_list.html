{% extends "base.html" %}

{% block title %}Вопросы{% endblock %}

{% block content %}
<section class="page">
  <header class="page-header">
    <div>
      <h1 class="page-title">База вопросов</h1>
      <p class="page-description">
        Здесь собраны вопросы для всех тестов. Вы можете открыть вопрос и изменить его текст, варианты ответов или структуру JSON.
      </p>
    </div>
  </header>

  {% if tests %}
    {% for test in tests %}
      <section class="test-section" data-tilt>
        <header class="test-section__header">
          <h2 class="card-title">{{ test.title }}</h2>
          <span class="badge">{{ test.test_id }}</span>
          <span class="test-section__meta">{{ test.questions|length }} вопросов</span>
        </header>
        <div class="question-list">
          {% for item in test.questions %}
            <article class="question-card">
              <div class="question-card__header">
                <span class="badge">№ {{ item.index }}</span>
                <h3 class="question-title">{{ item.title }}</h3>
                {% if item.kind == 'choice' %}
                  <span class="badge">Варианты</span>
                {% else %}
                  <span class="badge">Свободный ответ</span>
                {% endif %}
              </div>
              {% if item.prompt %}
                <p class="question-meta">{{ item.prompt }}</p>
              {% endif %}
              <div class="question-card__meta">
                {% if item.options_count %}
                  <span>Вариантов: {{ item.options_count }}{% if item.correct_label %}, верный: {{ item.correct_label }}{% endif %}</span>
                {% endif %}
                <span>Последнее изменение: {% if item.updated_at %}{{ fmt_utc(item.updated_at) }} UTC{% else %}—{% endif %}</span>
              </div>
              <div class="question-card__footer">
                {% if item.is_active %}
                  <span class="question-pill" data-tone="success">Активен</span>
                {% else %}
                  <span class="question-pill" data-tone="danger">Скрыт</span>
                {% endif %}
                <a class="btn btn-soft" href="/questions/{{ item.id }}/edit">Редактировать</a>
              </div>
            </article>
          {% else %}
            <div class="muted table-empty">Пока нет вопросов.</div>
          {% endfor %}
        </div>
      </section>
    {% endfor %}
  {% else %}
    <section class="test-section">
      <p class="page-description">Вопросы ещё не добавлены.</p>
    </section>
  {% endif %}
</section>
{% endblock %}
