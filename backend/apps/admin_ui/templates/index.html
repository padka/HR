{% extends "base.html" %}
{% block title %}Дашборд{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="/static/css/dashboard.css">
{% endblock %}

{% block content %}
<div class="dashboard-shell">
  <section class="surface hero-panel interactive-surface grain" data-effects="tilt hover" tabindex="0">
    <div class="hero-panel__content">
      <p class="hero-panel__eyebrow">Оперативная панель</p>
      <h1 class="hero-panel__title">Дашборд найма</h1>
      <p class="hero-panel__description">Следите за ключевыми метриками, создавайте новые сущности и держите команды в курсе прогресса, не покидая главную страницу.</p>
    </div>
    <div class="hero-panel__actions">
      <p class="hero-panel__actions-title">Быстрые действия</p>
      <div class="hero-panel__cta-group">
        <a class="btn btn--primary" href="/slots/new">Создать слот</a>
        <a class="btn btn--primary" href="/recruiters/new">Добавить рекрутёра</a>
      </div>
      <div class="hero-panel__cta-secondary">
        <a class="btn btn--ghost" href="/cities/new">Добавить город</a>
        <a class="btn btn--ghost" href="/templates/new">Новый шаблон</a>
      </div>
    </div>
  </section>

  <section class="metric-grid">
    <article class="surface metric-card interactive-surface grain" data-effects="tilt hover" tabindex="0">
      <span class="metric-card__label">Рекрутёры</span>
      <div class="metric-card__value">{{ counts.recruiters }}</div>
      <div class="metric-card__meta">
        <div class="metric-card__meta-row"></div>
        <a class="metric-card__link" href="/recruiters">Перейти к списку<span aria-hidden="true">→</span></a>
      </div>
    </article>

    <article class="surface metric-card interactive-surface grain" data-effects="tilt hover" tabindex="0">
      <span class="metric-card__label">Города</span>
      <div class="metric-card__value">{{ counts.cities }}</div>
      <div class="metric-card__meta">
        <div class="metric-card__meta-row"></div>
        <a class="metric-card__link" href="/cities">Перейти к списку<span aria-hidden="true">→</span></a>
      </div>
    </article>

    <article class="surface metric-card interactive-surface grain" data-effects="tilt hover" tabindex="0">
      <span class="metric-card__label">Слоты всего</span>
      <div class="metric-card__value">{{ counts.slots_total }}</div>
      <div class="metric-card__meta">
        <div class="metric-card__meta-row metric-card__badges">
          <span class="badge badge--soft">FREE: {{ counts.slots_free }}</span>
          <span class="badge badge--soft">PENDING: {{ counts.slots_pending }}</span>
          <span class="badge badge--soft">BOOKED: {{ counts.slots_booked }}</span>
        </div>
        <a class="metric-card__link" href="/slots">Перейти к слотам<span aria-hidden="true">→</span></a>
      </div>
    </article>

    <article class="surface metric-card interactive-surface grain" data-effects="tilt hover" tabindex="0">
      <span class="metric-card__label">Шаблоны</span>
      <div class="metric-card__value">{{ counts.templates|default(0) }}</div>
      <div class="metric-card__meta">
        <div class="metric-card__meta-row"></div>
        <a class="metric-card__link" href="/templates">Перейти к списку<span aria-hidden="true">→</span></a>
      </div>
    </article>
  </section>

  {% set actives = recruiters | selectattr('active') | list %}
  <section class="entity-panes">
    <article class="surface entity-pane interactive-surface grain" data-effects="hover" tabindex="0">
      <header class="entity-pane__header">
        <div>
          <p class="entity-pane__eyebrow">Команда</p>
          <h3 class="entity-pane__title">Активные рекрутёры</h3>
          <p class="entity-pane__subtitle">Следите за ответственными и их часовыми поясами.</p>
        </div>
        <a class="btn btn--ghost" href="/recruiters">Открыть все</a>
      </header>
      {% if not actives %}
        <p class="entity-pane__empty muted">Пока пусто. <a href="/recruiters/new">Добавить рекрутёра</a></p>
      {% else %}
        <ul class="entity-list">
          {% for r in actives %}
            <li class="entity-card">
              <span class="entity-card__id">#{{ r.id }}</span>
              <span class="entity-card__title">{{ r.name }}</span>
              <span class="entity-card__meta">{{ r.tz or "Europe/Moscow" }}</span>
              <span class="entity-card__status"><span class="badge badge--success">Активен</span></span>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </article>

    <article class="surface entity-pane interactive-surface grain" data-effects="hover" tabindex="0">
      <header class="entity-pane__header">
        <div>
          <p class="entity-pane__eyebrow">География</p>
          <h3 class="entity-pane__title">Города в работе</h3>
          <p class="entity-pane__subtitle">Контролируйте покрытие и операционные временные зоны.</p>
        </div>
        <a class="btn btn--ghost" href="/cities">Открыть все</a>
      </header>
      {% if not cities %}
        <p class="entity-pane__empty muted">Пока пусто. <a href="/cities/new">Добавить город</a></p>
      {% else %}
        <ul class="entity-list">
          {% for c in cities %}
            <li class="entity-card">
              <span class="entity-card__id">#{{ c.id }}</span>
              <span class="entity-card__title">{{ c.name }}</span>
              <span class="entity-card__meta">{{ c.tz or "Europe/Moscow" }}</span>
              <span class="entity-card__status"></span>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </article>
  </section>
</div>
{% endblock %}
