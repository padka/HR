{% extends "base.html" %}
{% block title %}Дашборд{% endblock %}
{% block content %}

<!-- Тулбар дашборда: заголовок + быстрые действия в Liquid Glass -->
<div class="card glass grain" data-tilt style="margin: 0 0 12px; padding: 12px;">
  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
    <h3 style="margin:0;">Дашборд</h3>
    <div style="margin-left:auto; display:flex; gap:8px; flex-wrap:wrap;">
      <a class="btn" href="/slots/new">+ Новый слот</a>
      <a class="btn" href="/recruiters/new">+ Новый рекрутёр</a>
      <a class="btn" href="/cities/new">+ Новый город</a>
      <a class="btn" href="/templates/new">+ Новый шаблон</a>
    </div>
  </div>
</div>

<div class="cards">
  <div class="card glass grain" data-tilt tabindex="0">
    <h4>Рекрутёры</h4>
    <div class="big">{{ counts.recruiters }}</div>
    <p style="margin:6px 0 0;"><a href="/recruiters">Перейти к списку</a></p>
  </div>

  <div class="card glass grain" data-tilt tabindex="0">
    <h4>Города</h4>
    <div class="big">{{ counts.cities }}</div>
    <p style="margin:6px 0 0;"><a href="/cities">Перейти к списку</a></p>
  </div>

  <div class="card glass grain" data-tilt tabindex="0">
    <h4>Слоты всего</h4>
    <div class="big">{{ counts.slots_total }}</div>
    <p class="badge">FREE: {{ counts.slots_free }} · PENDING: {{ counts.slots_pending }} · BOOKED: {{ counts.slots_booked }}</p>
    <p style="margin:6px 0 0;"><a href="/slots">Перейти к слотам</a></p>
  </div>

  <div class="card glass grain" data-tilt tabindex="0">
    <h4>Шаблоны</h4>
    <div class="big">{{ counts.templates|default(0) }}</div>
    <p style="margin:6px 0 0;"><a href="/templates">Перейти к списку</a></p>
  </div>
</div>

<div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
  <div class="card glass grain" data-tilt tabindex="0" style="padding:0;">
    <div style="padding:14px;">
      <h4 style="margin:0 0 10px 0;">Активные рекрутёры</h4>
      {% set actives = recruiters | selectattr('active') | list %}
      {% if not actives %}
        <p class="muted">Пока пусто. <a href="/recruiters/new">Добавить рекрутёра</a></p>
      {% else %}
        <table>
          <thead>
            <tr>
              <th style="width:60px;">ID</th>
              <th>Имя</th>
              <th style="width:200px;">TZ</th>
              <th style="width:120px;">Активен</th>
            </tr>
          </thead>
          <tbody>
          {% for r in actives %}
            <tr>
              <td>{{ r.id }}</td>
              <td>{{ r.name }}</td>
              <td>{{ r.tz or "Europe/Moscow" }}</td>
              <td>Да</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        <p style="margin:10px 0 0;"><a href="/recruiters">Открыть все</a></p>
      {% endif %}
    </div>
  </div>

  <div class="card glass grain" data-tilt tabindex="0" style="padding:0;">
    <div style="padding:14px;">
      <h4 style="margin:0 0 10px 0;">Города в работе</h4>
      {% if not cities %}
        <p class="muted">Пока пусто. <a href="/cities/new">Добавить город</a></p>
      {% else %}
        <table>
          <thead>
            <tr>
              <th style="width:60px;">ID</th>
              <th>Город</th>
              <th style="width:200px;">TZ</th>
            </tr>
          </thead>
          <tbody>
          {% for c in cities %}
            <tr>
              <td>{{ c.id }}</td>
              <td>{{ c.name }}</td>
              <td>{{ c.tz or "Europe/Moscow" }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        <p style="margin:10px 0 0;"><a href="/cities">Открыть все</a></p>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}