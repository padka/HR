{% extends "base.html" %}
{% block title %}Дашборд{% endblock %}
{% block content %}
<section class="dashboard-hero">
  <div class="hero__copy">
    <p class="hero__eyebrow">TG Bot · HR Operations</p>
    <h1 class="hero__title">Центр управления рекрутингом</h1>
    <p class="hero__description">Следите за воронкой кандидатов, слотами и продуктивностью команды в режиме реального времени.</p>
    <div class="hero__cta-group">
      <a class="btn btn-primary" href="/candidates">К кандидатам</a>
      <a class="btn btn-secondary" href="/recruiters">Управление рекрутёрами</a>
    </div>
  </div>
  <div class="hero__actions">
    <p class="hero__actions-title">Быстрые действия</p>
    <div class="hero__cta-secondary">
      <a class="btn btn-ghost" href="/slots/new">Создать слот</a>
      <a class="btn btn-ghost" href="/templates/new">Добавить шаблон</a>
      <a class="btn btn-ghost" href="/questions/new">Новый вопрос</a>
    </div>
  </div>
</section>

<section class="dashboard-metrics">
  <article class="metric-card glass-card">
    <span class="metric-card__label">Рекрутёры</span>
    <span class="metric-card__value">{{ counts.recruiters }}</span>
    <span class="metric-card__meta">Активных городов: {{ counts.cities }}</span>
  </article>
  <article class="metric-card glass-card">
    <span class="metric-card__label">Слоты</span>
    <span class="metric-card__value">{{ counts.slots_total }}</span>
    <span class="metric-card__meta">Свободно: {{ counts.slots_free }} • В ожидании: {{ counts.slots_pending }} • Забронировано: {{ counts.slots_booked }}</span>
  </article>
  <article class="metric-card glass-card">
    <span class="metric-card__label">Тест 1</span>
    <span class="metric-card__value">{{ counts.test1_total_seen }}</span>
    <span class="metric-card__meta">Отказы: {{ counts.test1_rejections_total }} ({{ counts.test1_rejections_percent }}%)</span>
  </article>
  <article class="metric-card glass-card">
    <span class="metric-card__label">Интеграция бота</span>
    <span class="metric-card__value">{{ bot_status.mode|upper }}</span>
    <span class="metric-card__meta">Готов к работе: {{ 'да' if bot_status.ready else 'нет' }}</span>
  </article>
</section>

<section class="surface">
  <header class="section-header">
    <h2 class="section-title">Состояние интеграции бота</h2>
    <p class="section-hint">Текущее состояние подключения к рантайму и конфигурации.</p>
  </header>
  <div class="list-table-wrapper">
    <table class="list-table">
      <tbody>
        <tr>
          <th scope="row">Конфигурация включена</th>
          <td>{{ 'Да' if bot_status.config_enabled else 'Нет' }}</td>
        </tr>
        <tr>
          <th scope="row">Рантайм активен</th>
          <td>{{ 'Да' if bot_status.runtime_enabled else 'Нет' }}</td>
        </tr>
        <tr>
          <th scope="row">Готовность сервиса</th>
          <td>{{ 'Да' if bot_status.ready else 'Нет' }}</td>
        </tr>
        <tr>
          <th scope="row">Состояние здоровья</th>
          <td>{{ bot_status.health or 'неизвестно' }}</td>
        </tr>
        <tr>
          <th scope="row">Режим</th>
          <td>{{ bot_status.mode }}</td>
        </tr>
        <tr>
          <th scope="row">Последнее обновление</th>
          <td>{{ bot_status.updated_at or '—' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<section class="surface">
  <header class="section-header">
    <h2 class="section-title">Статистика теста 1</h2>
    <p class="section-hint">Распределение отказов и общее количество прохождений.</p>
  </header>
  {% if counts.test1_rejections_breakdown %}
    <div class="list-table-wrapper">
      <table class="list-table">
        <thead>
          <tr>
            <th scope="col">Причина отказа</th>
            <th scope="col">Количество</th>
          </tr>
        </thead>
        <tbody>
          {% for reason, total in counts.test1_rejections_breakdown.items() %}
            <tr>
              <td>{{ reason }}</td>
              <td>{{ total }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">Пока нет зарегистрированных отказов по тесту.</p>
  {% endif %}
</section>
{% endblock %}
