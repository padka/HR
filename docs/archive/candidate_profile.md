# Профиль кандидата: быстрые действия и коммуникация

Короткое описание, как устроена карточка кандидата после чистки.

## Основные блоки
- **Паспорт**: телефон (копирование), Telegram (ссылки/история), ответственный рекрутер, источник и активность. Если чего‑то не хватает (Telegram, телефон, рекрутер, город, активность, интро‑день) — показываем подсказки в жёлтом алерте.
- **Действия**: кнопки берутся из `CandidateAction` (domain/actions.py). Отображаются только актуальные для статуса кандидата. GET‑действия ведут на страницы назначения/переноса, POST‑действия идут через новый API `/api/candidates/{id}/actions/{action_key}`.
- **Чат**: история и отправка сообщений Telegram из карточки. Источники шаблонов — `services/chat.py::CHAT_TEMPLATES`.

## API (admin UI)
- `GET /api/candidates/{id}/chat?limit=50&before=ISO` — история чата, пагинация через `before` (ISO datetime).
- `POST /api/candidates/{id}/chat` — отправка текста `{text, client_request_id?}`. Требует CSRF заголовок `X-CSRFToken` (в тестах/dev — проверка мягкая).
- `POST /api/candidates/{id}/chat/{message_id}/retry` — повторная отправка FAILED‑сообщения.
- `POST /api/candidates/{id}/actions/{action_key}` — выполнить действие из `CandidateAction` (например, `reject` → `interview_declined`). Возвращает `{ok, status, message}` и при успехе триггерит бот‑план, если он есть.

## Фичи и безопасные дефолты
- Легаси‑статусы (`/candidates/{id}/status`) скрыты, если `ENABLE_LEGACY_STATUS_API=false` (значение по умолчанию).
- Для чата и действий нет попыток обращаться к недоступным фичам: при отсутствии Telegram кнопки блокируются, сообщения не отправляются.
- Убрали мёртвые JS/CSS блоки для неиспользуемых слотов на карточке.

## Что проверить вручную
- Есть Telegram → открыть чат, отправить тестовое сообщение, увидеть статус `sent`/`failed`, попробовать `retry`.
- Нет Telegram → кнопка истории/отправки заблокирована, алерт предупреждает.
- Статус `TEST1_COMPLETED` → в блоке действий есть `Отказ`; после нажатия статус меняется на `interview_declined`.
